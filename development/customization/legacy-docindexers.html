<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Write a DocIndexer (legacy) | BlackLab</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Documentation for the corpus search engine BlackLab">
    
    <link rel="preload" href="/BlackLab/assets/css/0.styles.5760bb18.css" as="style"><link rel="preload" href="/BlackLab/assets/js/app.ff7e0bdb.js" as="script"><link rel="preload" href="/BlackLab/assets/js/2.3a027c82.js" as="script"><link rel="preload" href="/BlackLab/assets/js/19.1cd8af9b.js" as="script"><link rel="prefetch" href="/BlackLab/assets/js/10.a97bc1f2.js"><link rel="prefetch" href="/BlackLab/assets/js/11.891fe32f.js"><link rel="prefetch" href="/BlackLab/assets/js/12.2db99efc.js"><link rel="prefetch" href="/BlackLab/assets/js/13.e93eed8a.js"><link rel="prefetch" href="/BlackLab/assets/js/14.9364ad4a.js"><link rel="prefetch" href="/BlackLab/assets/js/15.405632c8.js"><link rel="prefetch" href="/BlackLab/assets/js/16.f3063769.js"><link rel="prefetch" href="/BlackLab/assets/js/17.06d27b1c.js"><link rel="prefetch" href="/BlackLab/assets/js/18.b90032a5.js"><link rel="prefetch" href="/BlackLab/assets/js/20.42bb357a.js"><link rel="prefetch" href="/BlackLab/assets/js/21.6b25d228.js"><link rel="prefetch" href="/BlackLab/assets/js/22.577e00a3.js"><link rel="prefetch" href="/BlackLab/assets/js/23.18694c3e.js"><link rel="prefetch" href="/BlackLab/assets/js/24.3f96f03f.js"><link rel="prefetch" href="/BlackLab/assets/js/25.ebeb39f6.js"><link rel="prefetch" href="/BlackLab/assets/js/26.afa2791a.js"><link rel="prefetch" href="/BlackLab/assets/js/27.bbc1ac3e.js"><link rel="prefetch" href="/BlackLab/assets/js/28.1607f8a7.js"><link rel="prefetch" href="/BlackLab/assets/js/29.74d0eb7f.js"><link rel="prefetch" href="/BlackLab/assets/js/3.dd448380.js"><link rel="prefetch" href="/BlackLab/assets/js/30.d69bc359.js"><link rel="prefetch" href="/BlackLab/assets/js/31.8d716075.js"><link rel="prefetch" href="/BlackLab/assets/js/32.a0ff5456.js"><link rel="prefetch" href="/BlackLab/assets/js/33.c497f89b.js"><link rel="prefetch" href="/BlackLab/assets/js/34.43fcfa33.js"><link rel="prefetch" href="/BlackLab/assets/js/35.57d60f91.js"><link rel="prefetch" href="/BlackLab/assets/js/36.6b5464f5.js"><link rel="prefetch" href="/BlackLab/assets/js/37.aa245bfb.js"><link rel="prefetch" href="/BlackLab/assets/js/38.e2221bf1.js"><link rel="prefetch" href="/BlackLab/assets/js/39.f9614a8f.js"><link rel="prefetch" href="/BlackLab/assets/js/4.250fd8f2.js"><link rel="prefetch" href="/BlackLab/assets/js/40.3e881176.js"><link rel="prefetch" href="/BlackLab/assets/js/41.19e38ff0.js"><link rel="prefetch" href="/BlackLab/assets/js/42.0465a6b1.js"><link rel="prefetch" href="/BlackLab/assets/js/43.2c80d081.js"><link rel="prefetch" href="/BlackLab/assets/js/44.43625a55.js"><link rel="prefetch" href="/BlackLab/assets/js/45.b5cea120.js"><link rel="prefetch" href="/BlackLab/assets/js/46.1b676431.js"><link rel="prefetch" href="/BlackLab/assets/js/47.85c2d39e.js"><link rel="prefetch" href="/BlackLab/assets/js/48.08158648.js"><link rel="prefetch" href="/BlackLab/assets/js/49.a4c61ca8.js"><link rel="prefetch" href="/BlackLab/assets/js/5.7080f60e.js"><link rel="prefetch" href="/BlackLab/assets/js/50.c78858d5.js"><link rel="prefetch" href="/BlackLab/assets/js/51.463bae8c.js"><link rel="prefetch" href="/BlackLab/assets/js/52.458bbe5f.js"><link rel="prefetch" href="/BlackLab/assets/js/53.39e9deef.js"><link rel="prefetch" href="/BlackLab/assets/js/54.425b4f2a.js"><link rel="prefetch" href="/BlackLab/assets/js/55.50c2c79a.js"><link rel="prefetch" href="/BlackLab/assets/js/56.eec17177.js"><link rel="prefetch" href="/BlackLab/assets/js/57.306ac3df.js"><link rel="prefetch" href="/BlackLab/assets/js/58.10fb9202.js"><link rel="prefetch" href="/BlackLab/assets/js/59.a192a7eb.js"><link rel="prefetch" href="/BlackLab/assets/js/6.bb3d2c40.js"><link rel="prefetch" href="/BlackLab/assets/js/60.8ff3f063.js"><link rel="prefetch" href="/BlackLab/assets/js/61.91d2ba44.js"><link rel="prefetch" href="/BlackLab/assets/js/62.f8d7a455.js"><link rel="prefetch" href="/BlackLab/assets/js/63.ba9049be.js"><link rel="prefetch" href="/BlackLab/assets/js/64.a10a4e4f.js"><link rel="prefetch" href="/BlackLab/assets/js/65.ab9870d5.js"><link rel="prefetch" href="/BlackLab/assets/js/66.b1a55608.js"><link rel="prefetch" href="/BlackLab/assets/js/67.c8966fb0.js"><link rel="prefetch" href="/BlackLab/assets/js/68.a0110da1.js"><link rel="prefetch" href="/BlackLab/assets/js/69.190cdd43.js"><link rel="prefetch" href="/BlackLab/assets/js/7.fe78c9fd.js"><link rel="prefetch" href="/BlackLab/assets/js/70.af6f5588.js"><link rel="prefetch" href="/BlackLab/assets/js/71.accb48b7.js"><link rel="prefetch" href="/BlackLab/assets/js/72.7d196c93.js"><link rel="prefetch" href="/BlackLab/assets/js/73.28b0fde7.js"><link rel="prefetch" href="/BlackLab/assets/js/74.60eed0ed.js"><link rel="prefetch" href="/BlackLab/assets/js/8.9dedd2e9.js"><link rel="prefetch" href="/BlackLab/assets/js/9.e6659fc6.js">
    <link rel="stylesheet" href="/BlackLab/assets/css/0.styles.5760bb18.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BlackLab/" class="home-link router-link-active"><!----> <span class="site-name">BlackLab</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/BlackLab/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/BlackLab/server/" class="nav-link">
  Webservice
</a></div><div class="nav-item"><a href="/BlackLab/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/BlackLab/development/" class="nav-link router-link-active">
  Developers
</a></div> <a href="https://github.com/INL/BlackLab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/BlackLab/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/BlackLab/server/" class="nav-link">
  Webservice
</a></div><div class="nav-item"><a href="/BlackLab/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/BlackLab/development/" class="nav-link router-link-active">
  Developers
</a></div> <a href="https://github.com/INL/BlackLab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/BlackLab/development/" aria-current="page" class="sidebar-link">Development resources</a></li><li><a href="/BlackLab/development/downloads.html" class="sidebar-link">Downloads</a></li><li><a href="/BlackLab/development/examples/example-application.html" class="sidebar-link">The Example Application</a></li><li><a href="/BlackLab/development/query-tool.html" class="sidebar-link">QueryTool</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Customization</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BlackLab/development/customization/docindexer.html" class="sidebar-link">Custom DocIndexer</a></li><li><a href="/BlackLab/development/customization/query-language.html" class="sidebar-link">Custom query language</a></li><li><a href="/BlackLab/development/customization/plugins.html" class="sidebar-link">Plugins for converting/tagging</a></li><li><a href="/BlackLab/development/customization/legacy-docindexers.html" aria-current="page" class="active sidebar-link">Write a DocIndexer (legacy)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#passing-indexing-parameters" class="sidebar-link">Passing indexing parameters</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#configuring-case-and-diacritics-sensitivity-per-annotation" class="sidebar-link">Configuring case- and diacritics sensitivity per annotation</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#configuring-the-index-structure" class="sidebar-link">Configuring the index structure</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#when-and-how-to-disable-the-forward-index-for-an-annotation" class="sidebar-link">When and how to disable the forward index for an annotation</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#custom-docindexers" class="sidebar-link">Custom DocIndexers</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#metadata" class="sidebar-link">Metadata</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/customization/legacy-docindexers.html#editing-the-index-metadata" class="sidebar-link">Editing the index metadata</a></li></ul></li></ul></section></li><li><a href="/BlackLab/development/solr/" class="sidebar-link">Solr (EXPERIMENTAL)</a></li><li><a href="/BlackLab/development/migration-guide.html" class="sidebar-link">Migration guide</a></li><li><a href="/BlackLab/development/changelog.html" class="sidebar-link">Change Log</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API redesign</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="write-a-docindexer-legacy"><a href="#write-a-docindexer-legacy" class="header-anchor">#</a> Write a DocIndexer (legacy)</h1> <p>The following information is only relevant if you use the legacy DocIndexers instead of an input format configuration file (<code>.blf.yaml</code>).</p> <h2 id="passing-indexing-parameters"><a href="#passing-indexing-parameters" class="header-anchor">#</a> Passing indexing parameters</h2> <p>You can pass parameters to the DocIndexer class to customize its indexing process. This can be done in two ways: as options on the IndexTool command line, or via a properties file.</p> <p>(if you use a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> to index your files, you don't need this)</p> <p>To pass a parameter as an option on the command line, use three dashes, like this:</p> <div class="language- extra-class"><pre><code>java -cp &quot;blacklab.jar:lib/*&quot; nl.inl.blacklab.tools.IndexTool create ---PARAMNAME PARAMVALUE ...
</code></pre></div><p>To pass parameters via a property file, use the --indexparam option:</p> <div class="language- extra-class"><pre><code>java -cp &quot;blacklab.jar:lib/*&quot; nl.inl.blacklab.tools.IndexTool create --indexparam PROPERTYFILE ...
</code></pre></div><p><strong>NOTE:</strong> in addition to the --indexparam parameter, IndexTool will always look for a file named indexer.properties in the current directory, the input directory, the parent of the input directory, or the index directory. If the file is found in any of these locations, it is read and the values are used as indexing parameters.</p> <p>Use the DocIndexer.getParameter(name[, defaultValue]) method to retrieve parameters inside your DocIndexer. For an example of using DocIndexer parameters, see the DocIndexerTeiBase and MetadataFetcherSonarCmdi in the nl.inl.blacklab.indexers package. They use parameters to configure annotation names and where to fetch metadata from, respectively.</p> <p>Configuring an external metadata fetcher (see &quot;Metadata from an external source&quot; below) and case- and diacritics sensitivity (see next section) is also done using a indexing parameter for now. Note that this parameter passing mechanism predates the index structure file (see &quot;Configuring the index structure&quot; below) and is likely to be deprecated in favour of that in future versions.</p> <h2 id="configuring-case-and-diacritics-sensitivity-per-annotation"><a href="#configuring-case-and-diacritics-sensitivity-per-annotation" class="header-anchor">#</a> Configuring case- and diacritics sensitivity per annotation</h2> <p>(if you use a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> to index your files, you can specify this there)</p> <p>You can also configure what &quot;sensitivity alternatives&quot; (case/diacritics sensitivity) to index for each annotation, using the &quot;PROPNAME_sensitivity&quot; parameter. Accepted values are &quot;i&quot; (both only insensitive), &quot;s&quot; (both only sensitive), &quot;si&quot; (sensitive and insensitive) and &quot;all&quot; (case/diacritics sensitive and insensitive, so 4 alternatives). What alternatives are indexed determines how specifically you can specify the desired sensitivity when searching.</p> <p>If you don't configure these, BlackLab will pick (hopefully) sane defaults (i.e. word/lemma get &quot;si&quot;, punct gets &quot;i&quot;, _relation/starttag gets &quot;s&quot;, others get &quot;i&quot;). (CAUTION: the special behaviour for word/lemma is deprecated. Please explictly configure the sensitivity for these annotations. Eventually they too will default to &quot;i&quot;)</p> <h2 id="configuring-the-index-structure"><a href="#configuring-the-index-structure" class="header-anchor">#</a> Configuring the index structure</h2> <p>(if you use a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> to index your files, you can specify all these settings there,
so you don't need a separate index structure file)</p> <p>What we call the &quot;index structure&quot; consists of some top-level index information (name, description, etc.), what word-level annotations
(formerly called &quot;properties&quot;) you want to index, what metadata fields there are and how they should be indexed, and more.</p> <p>By default, a default index structure is determined by BlackLab and the DocIndexer you're using. However, you can influence exactly
how your index is created using a customized index structure file. If you specify such an index structure file when creating the
index, it will be used as a template for the index metadata file, and so you won't have to specify the index structure file again
when updating your index later; all the information is now in the index metadata file. It is possible to edit the index metadata
file manually as well, but use caution, because it might break something.</p> <p>To use a custom indextemplate.yaml or indextemplate.json when creating an index, make sure the file is present either in the input
directory, or in the parent directory of the input directory. IndexTool will automatically detect and use it. The resulting index
metadata file will be saved in the index directory.</p> <p>There's a <a href="/BlackLab/guide/how-to-configure-indexing.html#edit-index-metadata">commented example of indexstructure.yaml</a>.</p> <p>Please note: the settings pidField, titleField, authorField, dateField refer to the name of the field in the Lucene index, not an XML element name.</p> <h2 id="when-and-how-to-disable-the-forward-index-for-an-annotation"><a href="#when-and-how-to-disable-the-forward-index-for-an-annotation" class="header-anchor">#</a> When and how to disable the forward index for an annotation</h2> <p>(if you use a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> to index your files, you can specify this there)</p> <p>By default, all properties get a forward index. The forward index is the complement to Lucene's reverse index, and can
quickly answer the question &quot;what value appears in position X of document Y?&quot;. This functionality is used to generate
snippets (such as for keyword-in-context (KWIC) views), to sort and group based on context words (such as sorting on the word left of the hit) and will in the future be used to speed up certain query types.</p> <p>However, forward indices take up a lot of disk space and can take up a lot of memory, and they are not always needed for every
annotation. You should probably have a forward index for at least the word and punct annotations, and for any annotation you'd like to sort/group on or that you use heavily in searching, or that you'd like to display in KWIC views. But if you add an annotation that is only used in certain special cases, you can decide to disable the forward index for that annotation. You can do this by adding the annotation name to the &quot;noForwardIndexProps&quot; space-separated list in the indextemplate.json file shown above.</p> <p>A note about forward indices and indexing multiple values at a single corpus position: as of right now, the forward index will only store the first value indexed at any position. We would like to expand this so that it is possible to quickly retrieve all values indexed at a corpus position, but that is not the case now.</p> <p>Note that if you want KWICs or snippets that include annotations without a forward index (as well the rest of the original XML), you can switch to using the original XML to generate KWICs and snippets, at the cost of speed. To do this, pass <code>usecontent=orig</code> to BlackLab Server, or call <code>Hits.settings().setConcordanceType(ConcordanceType.CONTENT_STORE)</code>.</p> <h2 id="custom-docindexers"><a href="#custom-docindexers" class="header-anchor">#</a> Custom DocIndexers</h2> <h3 id="indexing-word-annotated-xml"><a href="#indexing-word-annotated-xml" class="header-anchor">#</a> Indexing word-annotated XML</h3> <p>NOTE: an easier way of doing this is to <a href="/BlackLab/guide/how-to-configure-indexing.html">write a configuration file</a> instead of Java code.</p> <p>If you really want to implement your own DocIndexer class, see this <a href="/BlackLab/development/customization/docindexer.html">example</a>.</p> <p>If you have an XML format in which each word has its own XML tag, containing any annotations, you should derive your DocIndexer class from DocIndexerXmlHandlers. This class allows you to add 'hooks' for handling different XML elements.</p> <p>The constructor of your indexing class should call the superclass constructor, declare any annotations (e.g. lemma, pos) you're going to index and finally add hooks (called handlers)  for each XML element you want to do something with.</p> <p>Declaring annotations (formerly called &quot;properties&quot; in BlackLab) is done using the DocIndexerXmlHandlers.addAnnotation(String). Store the result in a final variable so you can access it from your custom handlers. Note that the &quot;main annotation&quot; (usually called &quot;word&quot;) and the &quot;punct&quot; annotation (whitespace and punctuation between words) have already been created by DocIndexerXmlHandlers; retrieve them using the mainAnnotation() and punctAnnotation() methods.</p> <p>Adding a handler is done using the DocIndexerXmlHandlers.addHandler(String, ElementHandler) method. The first parameter is an xpath-like expression that indicates the element to handle. The expression looks like xpath but is very limited: only element names separated by slashes; it may start with either a single (absolute path) or a double (relative path) slash. DocIndexerXmlHandlers defines several default ElementHandlers: ElementHandler (does nothing but keep track of whether we're inside this element), DocumentElementHandler (creates and adds document to the index), several metadata handlers that deal with different types of metadata elements (assuming the document contains its own metadata - see below for external metadata), InlineTagHandler (adds inline tags from the content to the index, such as &lt;p&gt;, &lt;s&gt; (sentence), &lt;b&gt;), several word handlers (indexes words and whitespace/punctuation between words). You can also easily create or derive your own, usually as an anonymous inner class that overrides the startElement() and endElement() methods.</p> <p>You need to add a handler for your document element (signifying the start and end of your logical documents; probably just use DocumentElementHandler), your word element (signifying a word to index; probably derive from WordHandlerBase), and any inline tags you wish to index (probably just use InlineTagHandler). Optionally, you may want to add a simple ElementHandler for your &quot;body&quot; tag, if you wish to restrict what part of the document is actually indexed; in this case, you should expand your word and inline tag handlers to check that you're inside this body element before processing the matched element.</p> <p>A word handler derived from DefaultWordHandler might retrieve lemma and part of speech from the attributes of the start tag and add them to the annotations you declared at the top of your DocIndexer-constructor. You can do this using the AnnotationWriter.addValue() method. DefaultWordHandler takes care of adding values to the standard annotations word and punct. For this, DefaultWordHandler assumes the word is simply the word element's text content. DefaultWordHandler also stores the character positions before and after the word (which are needed if you want to highlight in the original XML).</p> <p>An important note about adding values to annotations: it is crucial that you call AnnotationWriter.addValue() to each annotation an equal number of times! Each time you call addValue(), you move that annotation to the next corpus position, but other annotations do not automatically move to the next corpus position; it is up to you to make sure all annotations stay at the same corpus position. If a annotation has no value at a certain position, just add an empty string.</p> <p>You should probably call consumeCharacterContent(), which clears the buffer of captured text content in the document, at the start of a document (or at the start of the body element, if you handle that separately). This prevents the first punct value containing already captured text content you don't want. Similarly, before storing the document, you should add one last punct value (using consumeCharacterContent() to get the value to store), so the last bit of whitespace/punctuation isn't skipped. BlackLab assumes that there's always an &quot;extra closing token&quot; containing only the last bit of whitespace/punctuation.</p> <p>The <a href="/BlackLab/development/customization/docindexer.html">tutorial</a> develops a simple TEI DocIndexer using the above techniques.</p> <h3 id="multiple-values-at-one-position-position-gaps-and-adding-annotation-values-at-an-earlier-position"><a href="#multiple-values-at-one-position-position-gaps-and-adding-annotation-values-at-an-earlier-position" class="header-anchor">#</a> Multiple values at one position, position gaps and adding annotation values at an earlier position</h3> <p>NOTE: this applies if you're implementing your own DocIndexer class. The other appraoch, using a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a>, does support standoff annotations but has no support for multiple values at one position (yet). Please let us know if you need this.</p> <p>The AnnotationWriter.addValue(String) method adds a value to an annotation at the next corpus position. Sometimes you may want to add multiple values at a single corpus position, or you may want to skip a number of corpus positions. This can be done using the AnnotationWriter.addValue(String, Integer) method; the second parameter is the increment compared to the previous value. The default value for the increment is 1, meaning each value is indexed at the next corpus position.</p> <p>To add multiple values to a single corpus position, only use the default increment of 1 for the first value you want to add at this position; for all subsequent values at this position, use an increment of 0. Note: if the value you added first was the empty string, adding the next value with an increment of 0 will overwrite this empty string. This can be convenient if you're not sure whether you want to add any values at a particular location, but you want to make sure the annotation stays at the correct corpus position regardless.</p> <p>To skip a number of corpus positions when adding a value, use an increment that is higher than 1. So to skip one position (and therefore leave a &quot;gap&quot; one wide), use an increment of 2.</p> <p>Finally, you may sometimes wish to add values to an earlier corpus position. Say you're at position 100, and you want to add a value to position 50. You can do so using the AnnotationWriter.addValueAtPosition(String, Integer) method. The first token has position 0.</p> <h3 id="subannotations-for-e-g-making-part-of-speech-features-separately-searchable-experimental"><a href="#subannotations-for-e-g-making-part-of-speech-features-separately-searchable-experimental" class="header-anchor">#</a> Subannotations, for e.g. making part of speech features separately searchable (EXPERIMENTAL)</h3> <p>(you should use a <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> for this)</p> <h3 id="storing-extra-information-with-annotation-values-using-payloads"><a href="#storing-extra-information-with-annotation-values-using-payloads" class="header-anchor">#</a> Storing extra information with annotation values, using payloads</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> approach does not support this yet; let us know if you need this)</p> <p>It is possible to add payloads to annotation values. When calling addAnnotation() at the start of the constructor, make sure to use the version that takes a boolean called 'includePayloads', and set it to true. Then use AnnotationWriter.addPayload(). You can use null if a particular value has no payload. There's also a addPayloadAtIndex() method to add payloads some time after adding the value itself, but that requires knowing the index in the value list of the value you want to add a payload for, so you should store this index when you add the value.</p> <p>One example of using payloads can be seen in DocIndexerXmlHandlers.InlineTagHandler. When you use InlineTagHandler to index an inline element, say a sentence tag, BlackLab will index it to the '_relation' (or older 'starttag') annotation. When it encounters the end tag, it wil update the start tag value with a payload indication the element length. This is used when searching to determine what matches occur inside certain XML tags.</p> <h3 id="indexing-non-xml-file-types"><a href="#indexing-non-xml-file-types" class="header-anchor">#</a> Indexing non-XML file types</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> approach directly supports tabular (CSV/TSV) input formats and the plain text input format)</p> <p>If your input files are not XML or are not tokenized and annotated per word, you have two options: convert them into a tokenized, per-word annotated format, or index them directly.</p> <p>Indexing them directly is not covered here, but involves deriving from DocIndexerAbstract or implementing the DocIndexer interface yourself. If you need help with this, please <a href="/BlackLab/guide/about.html#contact-us">contact us</a>.</p> <h2 id="metadata"><a href="#metadata" class="header-anchor">#</a> Metadata</h2> <h3 id="in-document-metadata"><a href="#in-document-metadata" class="header-anchor">#</a> In-document metadata</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> support this directly)</p> <p>Some documents contain metadata within the document. You usually want to index these as fields with your document, so you can filter on them later. You do this by adding a handler for the appropriate XML element.</p> <p>There's a few helper classes for in-document metadata handling. MetadataElementHandler assumes the matched element name is the name of your metadata field and the character content is the value. MetadataAttributesHandler stores all the attributes from the matched element as metadata fields. MetadataNameValueAttributeHandler assumes the matched element has a name attribute and a value attribute (the attribute names can be specified in the constructor) and stores those as metadata fields. You can of course easily add your own handler classes to this if they don't suit your particular style of metadata (have a look at nl.inl.blacklab.index.DocIndexerXmlHandlers.java to see how the predefined ones are implemented).</p> <h3 id="metadata-from-an-external-source"><a href="#metadata-from-an-external-source" class="header-anchor">#</a> Metadata from an external source</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> support this directly)</p> <p>Sometimes, documents link to external metadata sources, usually using an ID.</p> <p>The MetadataFetcher is instantiated by DocIndexerXmlHandlers.getMetadataFetcher(), based on the metadataFetcherClass indexer parameter (see &quot;Passing indexing parameters&quot; above). This class is instantiated with the DocIndexer as a parameter, and the addMetadata() method is called just before adding a document to the index. Your particular MetadataFetcher can inspect the document to find the appropriate ID, fetch the metadata (e.g. from a file, database or webservice) and add it to the document using the DocIndexerXmlHandlers.addMetadataField() method.</p> <p>Also see the two MetadataFetcher examples in nl.inl.blacklab.indexers.</p> <h3 id="add-a-fixed-metadata-field-to-each-document"><a href="#add-a-fixed-metadata-field-to-each-document" class="header-anchor">#</a> Add a fixed metadata field to each document</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> support this directly)</p> <p>It is possible to tell IndexTool to add a metadata field with a specific value to each document indexed. An example of when this is useful is if you wish to combine several corpora into a single index, and wish to distinguish documents from the different corpora using this metadata field. You would achieve this by running IndexTool twice: once to create the index and add the documents from the first corpus, &quot;tagging&quot; them with a field named e.g. Corpus_title (which is the fieldname <a href="https://github.com/Taalmonsters/WhiteLab2.0" target="_blank" rel="noopener noreferrer">Whitelab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> expects) with an appropriate value indicating the first corpus. Then you would run IndexTool again, with command &quot;append&quot; to append documents to the existing index, and giving Corpus_title a different value for this set of documents.</p> <p>There's two ways to add this fixed metadata field for an IndexTool run. One is to pass an option &quot;---meta-Corpus_title mycorpusname&quot; (note the 3 dashes!) to the IndexTool. The other is to place a property &quot;meta-Corpus_title=mycorpusname&quot; in a file called indexer.properties in the current directory. This file can be used for other per-run IndexTool configuration; see below.</p> <h3 id="controlling-how-metadata-is-fetched-and-indexed"><a href="#controlling-how-metadata-is-fetched-and-indexed" class="header-anchor">#</a> Controlling how metadata is fetched and indexed</h3> <p>(the <a href="/BlackLab/guide/how-to-configure-indexing.html">configuration file</a> support this directly)</p> <p>By default, metadata fields are tokenized, but it can sometimes be useful to index a metadata field without tokenizing it. One example of this is a field containing the document id: if your document ids contain characters that normally would indicate a token boundary, like a period (.) , your document id would be split into several tokens, which is usually not what you want. Use the indextemplate.json file (described above) to indicate you don't want a metadata field to be tokenized.</p> <h2 id="editing-the-index-metadata"><a href="#editing-the-index-metadata" class="header-anchor">#</a> Editing the index metadata</h2> <p>NOTE: it is best to <a href="/BlackLab/guide/how-to-configure-indexing.html#influence-index-metadata">influence the index metadata</a> through your input format configuration file. That way, re-indexing your data doesn't overwrite your changes.</p> <p>In addition to specifying this information in your input format configuration file as described above, it is also possible to edit the index metadata file manually. If you do this, be careful, because it might break something. It is best to use a text editor with support for YAML, and to validate the resulting file with a YAML validator such as <a href="http://www.yamllint.com/" target="_blank" rel="noopener noreferrer">YAML Lint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Also remember that if you edit the index metadata file, and you later decide to generate a new index from scratch, your changes to the metadata file will be lost. If possible, it is therefore preferable to put this information in the input format configuration file directly. (If you find that this is not possible in your case, please let us know.)</p> <p>Here's a commented example of indexmetadata.yaml:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token comment"># Display name for the index and short description</span>
<span class="token comment"># (not used by BlackLab. None of the display name or description values</span>
<span class="token comment">#  are used by BlackLab directly, but applications can retrieve them if they want)</span>
<span class="token key atrule">displayName</span><span class="token punctuation">:</span> OpenSonar
<span class="token key atrule">description</span><span class="token punctuation">:</span> The OpenSonar corpus.

<span class="token comment"># What was the name of the input format first added to this index?</span>
<span class="token comment"># (it is possible to add documents of different formats to the same index,</span>
<span class="token comment">#  so this is not a guarantee that all documents have this format)</span>
<span class="token key atrule">documentFormat</span><span class="token punctuation">:</span> OpenSonarFolia

<span class="token comment"># Total number of tokens in this corpus.</span>
<span class="token key atrule">tokenCount</span><span class="token punctuation">:</span> <span class="token number">12345</span>

<span class="token comment"># Information about the index format and when and how it was created</span>
<span class="token comment"># (don't change this)</span>
<span class="token key atrule">versionInfo</span><span class="token punctuation">:</span>
    <span class="token key atrule">blackLabBuildTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2017-08-01 00:00:00&quot;</span>
    <span class="token key atrule">blackLabVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;1.7.0&quot;</span>
    <span class="token key atrule">indexFormat</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
    <span class="token key atrule">timeCreated</span><span class="token punctuation">:</span> <span class="token string">&quot;2017-07-31 16:03:37&quot;</span>
    <span class="token key atrule">timeModified</span><span class="token punctuation">:</span> <span class="token string">&quot;2017-07-31 16:03:37&quot;</span>
    <span class="token key atrule">alwaysAddClosingToken</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">tagLengthInPayload</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># Information about annotated (complex) and metadata fields</span>
<span class="token key atrule">fieldInfo</span><span class="token punctuation">:</span>
    <span class="token key atrule">titleField</span><span class="token punctuation">:</span> title            <span class="token comment"># ((optional, detected if omitted); field in the index containing</span>
                                <span class="token comment">#  document title; may be used by applications)</span>
    <span class="token key atrule">authorField</span><span class="token punctuation">:</span> author          <span class="token comment"># ((optional) field in the index containing author information;</span>
                                <span class="token comment">#  may be used by applications)</span>
    <span class="token key atrule">dateField</span><span class="token punctuation">:</span> date              <span class="token comment"># ((optional) field in the index containing document date </span>
                                <span class="token comment">#  information; may be used by applications)</span>
    <span class="token key atrule">pidField</span><span class="token punctuation">:</span> id                 <span class="token comment"># ((optional, recommended) field in the index containing unique </span>
                                <span class="token comment">#  document id; may be used by applications to refer to documents;</span>
                                <span class="token comment">#  may be used by BlackLab to directly update documents without </span>
                                <span class="token comment">#  the client having to manually delete the previous version)</span>
    <span class="token key atrule">defaultAnalyzerName</span><span class="token punctuation">:</span> DEFAULT <span class="token comment"># The type of analyzer to use for metadata fields</span>
                                <span class="token comment"># by default (DEFAULT|whitespace|standard|nontokenizing)</span>
    <span class="token key atrule">contentViewable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>       <span class="token comment"># is the user allowed to retrieve whole documents? </span>
    <span class="token key atrule">textDirection</span><span class="token punctuation">:</span> LTR           <span class="token comment"># text direction of the corpus (e.g. LTR/RTL) (not used by BlackLab) </span>
    <span class="token key atrule">documentFormat</span><span class="token punctuation">:</span> <span class="token string">''</span>           <span class="token comment"># (not used by BlackLab. may be used by application to </span>
                                <span class="token comment">#  e.g. select which XSLT to use)</span>
    <span class="token key atrule">unknownValue</span><span class="token punctuation">:</span> unknown        <span class="token comment"># what value to index if field value is unknown [unknown]</span>
    <span class="token key atrule">unknownCondition</span><span class="token punctuation">:</span> NEVER      <span class="token comment"># When is a field value considered unknown?</span>
                                <span class="token comment"># (other options: MISSING, EMPTY, MISSING_OR_EMPTY) [NEVER]</span>
    
    <span class="token comment"># Information about specific metadata fields</span>
    <span class="token key atrule">metadataFields</span><span class="token punctuation">:</span>
    
    <span class="token comment"># Information about the author field</span>
    <span class="token key atrule">author</span><span class="token punctuation">:</span>
        <span class="token key atrule">displayName</span><span class="token punctuation">:</span> author                      <span class="token comment"># (optional) How to display in interface</span>
        <span class="token key atrule">description</span><span class="token punctuation">:</span> The author of the document. <span class="token comment"># (optional) Description (e.g. tooltip) in interface</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> tokenized                          <span class="token comment"># ..or text, numeric, untokenized [tokenized]</span>
        <span class="token key atrule">analyzer</span><span class="token punctuation">:</span> default                        <span class="token comment"># ..(or whitespace|standard|nontokenizing) [default]</span>
        <span class="token key atrule">unknownValue</span><span class="token punctuation">:</span> unknown                    <span class="token comment"># overrides default unknownValue for this field</span>
        <span class="token key atrule">unknownCondition</span><span class="token punctuation">:</span> MISSING_OR_EMPTY       <span class="token comment"># overrides default unknownCondition for this field</span>
        <span class="token key atrule">uiType</span><span class="token punctuation">:</span> select                           <span class="token comment"># (optional) Widget to use in interface (text|select|range)</span>
        <span class="token key atrule">values</span><span class="token punctuation">:</span>                                  <span class="token comment"># values indexed in this field</span>
        <span class="token punctuation">-</span> firstValue
        <span class="token punctuation">-</span> secondValue
        <span class="token key atrule">valueListComplete</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                  <span class="token comment"># are all values listed here, or just a few (max. 50)?</span>
        <span class="token key atrule">displayValues</span><span class="token punctuation">:</span>                           <span class="token comment"># (optional) How to display certain values in this field</span>
        <span class="token key atrule">tolkien</span><span class="token punctuation">:</span> J.R.R. Tolkien                <span class="token comment">#   e.g. display value &quot;tolkien&quot; as &quot;J.R.R. Tolkien&quot;</span>
        <span class="token key atrule">adams</span><span class="token punctuation">:</span> Douglas Adams
        <span class="token key atrule">displayOrder</span><span class="token punctuation">:</span>                            <span class="token comment"># (optional) Specific order to display values in</span>
        <span class="token punctuation">-</span> tolkien
        <span class="token punctuation">-</span> adams
    
    <span class="token comment"># (optional)</span>
    <span class="token comment"># This block allows you to define groups of metadata fields.</span>
    <span class="token comment"># BlackLab Server will include this information on the index structure page.</span>
    <span class="token comment"># This can be useful if you want to generate a user interface based on index metadata. </span>
    <span class="token key atrule">metadataFieldGroups</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> First group
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> author
    <span class="token punctuation">-</span> title
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Second group
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> date
    <span class="token punctuation">-</span> keywords
    <span class="token key atrule">addRemainingFields</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># plus any fields that weren't mentioned yet </span>
    
    <span class="token comment"># Information about annotated fields</span>
    <span class="token comment"># (these used to be called complex fields, hence the key name;</span>
    <span class="token comment">#  similarly, we used to call annotations &quot;properties&quot;, as you can see below)</span>
    <span class="token key atrule">complexFields</span><span class="token punctuation">:</span>
    
    <span class="token comment"># Information about the contents field</span>
    <span class="token key atrule">contents</span><span class="token punctuation">:</span>
        <span class="token key atrule">mainProperty</span><span class="token punctuation">:</span> word         <span class="token comment"># main annotation. used for concordances; contains char. offsets</span>
        <span class="token key atrule">displayName</span><span class="token punctuation">:</span> contents      <span class="token comment"># (optional) how to display in GUI</span>
        <span class="token key atrule">description</span><span class="token punctuation">:</span> The text contents of the document.
        <span class="token key atrule">noForwardIndexProps</span><span class="token punctuation">:</span> <span class="token string">''</span>    <span class="token comment"># (optional) space-separated list of annotation</span>
                                   <span class="token comment"># names that shouldn't get a forward index</span>
        <span class="token key atrule">displayOrder</span><span class="token punctuation">:</span>              <span class="token comment"># (optional) Order to display annotation search fields</span>
        <span class="token punctuation">-</span> word
        <span class="token punctuation">-</span> lemma
        <span class="token punctuation">-</span> pos
</code></pre></div><p>Please note: the settings pidField, titleField, authorField, dateField refer to the name of the field in the Lucene index, not an XML element name.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/INL/BlackLab/edit/dev/site/docs/development/customization/legacy-docindexers.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/1/2024, 11:17:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BlackLab/development/customization/plugins.html" class="prev">
        Plugins for converting/tagging
      </a></span> <span class="next"><a href="/BlackLab/development/solr/">
        Solr (EXPERIMENTAL)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BlackLab/assets/js/app.ff7e0bdb.js" defer></script><script src="/BlackLab/assets/js/2.3a027c82.js" defer></script><script src="/BlackLab/assets/js/19.1cd8af9b.js" defer></script>
  </body>
</html>
