<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Change Log | BlackLab</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="Documentation for the corpus search engine BlackLab">
    
    <link rel="preload" href="/BlackLab/assets/css/0.styles.5760bb18.css" as="style"><link rel="preload" href="/BlackLab/assets/js/app.ff7e0bdb.js" as="script"><link rel="preload" href="/BlackLab/assets/js/2.3a027c82.js" as="script"><link rel="preload" href="/BlackLab/assets/js/17.06d27b1c.js" as="script"><link rel="prefetch" href="/BlackLab/assets/js/10.a97bc1f2.js"><link rel="prefetch" href="/BlackLab/assets/js/11.891fe32f.js"><link rel="prefetch" href="/BlackLab/assets/js/12.2db99efc.js"><link rel="prefetch" href="/BlackLab/assets/js/13.e93eed8a.js"><link rel="prefetch" href="/BlackLab/assets/js/14.9364ad4a.js"><link rel="prefetch" href="/BlackLab/assets/js/15.405632c8.js"><link rel="prefetch" href="/BlackLab/assets/js/16.f3063769.js"><link rel="prefetch" href="/BlackLab/assets/js/18.b90032a5.js"><link rel="prefetch" href="/BlackLab/assets/js/19.1cd8af9b.js"><link rel="prefetch" href="/BlackLab/assets/js/20.42bb357a.js"><link rel="prefetch" href="/BlackLab/assets/js/21.6b25d228.js"><link rel="prefetch" href="/BlackLab/assets/js/22.577e00a3.js"><link rel="prefetch" href="/BlackLab/assets/js/23.18694c3e.js"><link rel="prefetch" href="/BlackLab/assets/js/24.3f96f03f.js"><link rel="prefetch" href="/BlackLab/assets/js/25.ebeb39f6.js"><link rel="prefetch" href="/BlackLab/assets/js/26.afa2791a.js"><link rel="prefetch" href="/BlackLab/assets/js/27.bbc1ac3e.js"><link rel="prefetch" href="/BlackLab/assets/js/28.1607f8a7.js"><link rel="prefetch" href="/BlackLab/assets/js/29.74d0eb7f.js"><link rel="prefetch" href="/BlackLab/assets/js/3.dd448380.js"><link rel="prefetch" href="/BlackLab/assets/js/30.d69bc359.js"><link rel="prefetch" href="/BlackLab/assets/js/31.8d716075.js"><link rel="prefetch" href="/BlackLab/assets/js/32.a0ff5456.js"><link rel="prefetch" href="/BlackLab/assets/js/33.c497f89b.js"><link rel="prefetch" href="/BlackLab/assets/js/34.43fcfa33.js"><link rel="prefetch" href="/BlackLab/assets/js/35.57d60f91.js"><link rel="prefetch" href="/BlackLab/assets/js/36.6b5464f5.js"><link rel="prefetch" href="/BlackLab/assets/js/37.aa245bfb.js"><link rel="prefetch" href="/BlackLab/assets/js/38.e2221bf1.js"><link rel="prefetch" href="/BlackLab/assets/js/39.f9614a8f.js"><link rel="prefetch" href="/BlackLab/assets/js/4.250fd8f2.js"><link rel="prefetch" href="/BlackLab/assets/js/40.3e881176.js"><link rel="prefetch" href="/BlackLab/assets/js/41.19e38ff0.js"><link rel="prefetch" href="/BlackLab/assets/js/42.0465a6b1.js"><link rel="prefetch" href="/BlackLab/assets/js/43.2c80d081.js"><link rel="prefetch" href="/BlackLab/assets/js/44.43625a55.js"><link rel="prefetch" href="/BlackLab/assets/js/45.b5cea120.js"><link rel="prefetch" href="/BlackLab/assets/js/46.1b676431.js"><link rel="prefetch" href="/BlackLab/assets/js/47.85c2d39e.js"><link rel="prefetch" href="/BlackLab/assets/js/48.08158648.js"><link rel="prefetch" href="/BlackLab/assets/js/49.a4c61ca8.js"><link rel="prefetch" href="/BlackLab/assets/js/5.7080f60e.js"><link rel="prefetch" href="/BlackLab/assets/js/50.c78858d5.js"><link rel="prefetch" href="/BlackLab/assets/js/51.463bae8c.js"><link rel="prefetch" href="/BlackLab/assets/js/52.458bbe5f.js"><link rel="prefetch" href="/BlackLab/assets/js/53.39e9deef.js"><link rel="prefetch" href="/BlackLab/assets/js/54.425b4f2a.js"><link rel="prefetch" href="/BlackLab/assets/js/55.50c2c79a.js"><link rel="prefetch" href="/BlackLab/assets/js/56.eec17177.js"><link rel="prefetch" href="/BlackLab/assets/js/57.306ac3df.js"><link rel="prefetch" href="/BlackLab/assets/js/58.10fb9202.js"><link rel="prefetch" href="/BlackLab/assets/js/59.a192a7eb.js"><link rel="prefetch" href="/BlackLab/assets/js/6.bb3d2c40.js"><link rel="prefetch" href="/BlackLab/assets/js/60.8ff3f063.js"><link rel="prefetch" href="/BlackLab/assets/js/61.91d2ba44.js"><link rel="prefetch" href="/BlackLab/assets/js/62.f8d7a455.js"><link rel="prefetch" href="/BlackLab/assets/js/63.ba9049be.js"><link rel="prefetch" href="/BlackLab/assets/js/64.a10a4e4f.js"><link rel="prefetch" href="/BlackLab/assets/js/65.ab9870d5.js"><link rel="prefetch" href="/BlackLab/assets/js/66.b1a55608.js"><link rel="prefetch" href="/BlackLab/assets/js/67.c8966fb0.js"><link rel="prefetch" href="/BlackLab/assets/js/68.a0110da1.js"><link rel="prefetch" href="/BlackLab/assets/js/69.190cdd43.js"><link rel="prefetch" href="/BlackLab/assets/js/7.fe78c9fd.js"><link rel="prefetch" href="/BlackLab/assets/js/70.af6f5588.js"><link rel="prefetch" href="/BlackLab/assets/js/71.accb48b7.js"><link rel="prefetch" href="/BlackLab/assets/js/72.7d196c93.js"><link rel="prefetch" href="/BlackLab/assets/js/73.28b0fde7.js"><link rel="prefetch" href="/BlackLab/assets/js/74.60eed0ed.js"><link rel="prefetch" href="/BlackLab/assets/js/8.9dedd2e9.js"><link rel="prefetch" href="/BlackLab/assets/js/9.e6659fc6.js">
    <link rel="stylesheet" href="/BlackLab/assets/css/0.styles.5760bb18.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BlackLab/" class="home-link router-link-active"><!----> <span class="site-name">BlackLab</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/BlackLab/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/BlackLab/server/" class="nav-link">
  Webservice
</a></div><div class="nav-item"><a href="/BlackLab/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/BlackLab/development/" class="nav-link router-link-active">
  Developers
</a></div> <a href="https://github.com/INL/BlackLab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/BlackLab/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/BlackLab/server/" class="nav-link">
  Webservice
</a></div><div class="nav-item"><a href="/BlackLab/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/BlackLab/development/" class="nav-link router-link-active">
  Developers
</a></div> <a href="https://github.com/INL/BlackLab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/BlackLab/development/" aria-current="page" class="sidebar-link">Development resources</a></li><li><a href="/BlackLab/development/downloads.html" class="sidebar-link">Downloads</a></li><li><a href="/BlackLab/development/examples/example-application.html" class="sidebar-link">The Example Application</a></li><li><a href="/BlackLab/development/query-tool.html" class="sidebar-link">QueryTool</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Customization</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/BlackLab/development/solr/" class="sidebar-link">Solr (EXPERIMENTAL)</a></li><li><a href="/BlackLab/development/migration-guide.html" class="sidebar-link">Migration guide</a></li><li><a href="/BlackLab/development/changelog.html" aria-current="page" class="active sidebar-link">Change Log</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#improvements-in-dev" class="sidebar-link">Improvements in dev</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#improvements-in-3-0-1" class="sidebar-link">Improvements in 3.0.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_3-0-0" class="sidebar-link">3.0.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-3-1" class="sidebar-link">2.3.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-3-0" class="sidebar-link">2.3.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-2-0" class="sidebar-link">2.2.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-1-1" class="sidebar-link">2.1.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-1-0" class="sidebar-link">2.1.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_2-0-0" class="sidebar-link">2.0.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-7-2" class="sidebar-link">1.7.2</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-7-1" class="sidebar-link">1.7.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-7-0" class="sidebar-link">1.7.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-6-0" class="sidebar-link">1.6.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-5-0" class="sidebar-link">1.5.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-4-1" class="sidebar-link">1.4.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-4-0" class="sidebar-link">1.4.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-7" class="sidebar-link">1.3.7</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-6" class="sidebar-link">1.3.6</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-5" class="sidebar-link">1.3.5</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-4" class="sidebar-link">1.3.4</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-3" class="sidebar-link">1.3.3</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-2" class="sidebar-link">1.3.2</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3-1" class="sidebar-link">1.3.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-3" class="sidebar-link">1.3</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-2-1" class="sidebar-link">1.2.1</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-2-0" class="sidebar-link">1.2.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-1-0" class="sidebar-link">1.1.0</a></li><li class="sidebar-sub-header"><a href="/BlackLab/development/changelog.html#_1-0" class="sidebar-link">1.0</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API redesign</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="change-log"><a href="#change-log" class="header-anchor">#</a> Change Log</h1> <h2 id="improvements-in-dev"><a href="#improvements-in-dev" class="header-anchor">#</a> Improvements in dev</h2> <h3 id="changed"><a href="#changed" class="header-anchor">#</a> Changed</h3> <ul><li>annotation setting allowDuplicateValues defaults to false, which is usually what you want.</li> <li>various performance improvements, e.g. when opening huge indexes. Also Lucene's two-phase iterators are used where possible.</li> <li>BlackLab Corpus Query Language (BCQL) queries now allow dashes in names. Integrated index type allows dash in forEach names.</li> <li>BCQL now allows the not-operator (<code>!</code>) to be used at the top level, and &quot;global&quot; constraints (<code>::</code>) to be used within parentheses as well.</li> <li>Unicode normalization is applied to documents while indexing.</li> <li>If a corpus directory is named <code>index</code>, we used to look at the parent directory for the &quot;real&quot; corpus name, but this quirk has been removed.</li></ul> <h3 id="fixed"><a href="#fixed" class="header-anchor">#</a> Fixed</h3> <ul><li>Querying numeric fields was broken but should work correctly again.</li> <li></li></ul> <h3 id="new"><a href="#new" class="header-anchor">#</a> New</h3> <ul><li><p>integrated index</p></li> <li><p>ability to run BlackLab as a Solr plugin (work in progress), and a proxy so Solr with plugin behaves the same as BLS.</p></li> <li><p>Evolving the BLS API</p></li> <li><p>indexing and searching (dependency) relations. Support for the CoNLL-U format, and configuring your own XML-based format using special standoff annotations.</p></li> <li><p>hit uniqueness now considers match info (capture groups etc.) as well, so multiple hits with the same doc, start and end may be reported (with each having different match info)</p></li> <li><p>match info includes captures, inline tags and relations.</p></li> <li><p>you can request all relations in a sentence now.</p></li> <li><p>much improved Saxon indexer</p></li> <li><p>much improved unit and CI testing</p></li> <li><p>group by capture</p></li> <li><p>new DocIndexerExample gives a better example of low-level custom indexing</p></li> <li><p>you can now index spans and relations using standoff annotations as well</p></li> <li><p>support for Docker</p></li> <li><p>a JSON form of each query is returned by the API. You can also pass this JSON form to the REST API as an alternative to BCQL. This is useful for e.g. implementing a query builder. There is also an operation (/parse-pattern) that just returns the JSON form of a query.</p></li> <li><p>more warnings are logged if something is wrong, e.g. indexing without a persistent document identifier (pidField) configured.</p></li> <li><p>QueryTool can now be used for performance and correctness testing</p></li> <li><p>userIndexMaxTokenCount setting</p></li> <li><p>option to omit empty captures</p></li></ul> <h3 id="removed"><a href="#removed" class="header-anchor">#</a> Removed</h3> <ul><li>Removed <code>vmtouch</code> from repo (no longer recommended)</li></ul> <h3 id="docs"><a href="#docs" class="header-anchor">#</a> Docs</h3> <ul><li>New site, with full REST API docs</li> <li>Added BARKs ((BlackLab Archives of Relevant Knowledge)</li> <li>Documented CQL operator precedence, query rewriting, etc.</li></ul> <h2 id="improvements-in-3-0-1"><a href="#improvements-in-3-0-1" class="header-anchor">#</a> Improvements in 3.0.1</h2> <h3 id="changed-2"><a href="#changed-2" class="header-anchor">#</a> Changed</h3> <ul><li>Remove Solr dependencies (via SlowCompositeReaderWrapper). Those made the WAR huge and
caused problems with some application servers (because Jetty was being pulled in).</li></ul> <h2 id="_3-0-0"><a href="#_3-0-0" class="header-anchor">#</a> 3.0.0</h2> <h3 id="changed-3"><a href="#changed-3" class="header-anchor">#</a> Changed</h3> <ul><li>Minimum Java version was raised from 8 to 11.</li> <li>Based on Lucene 8. Thanks to @zhyongwei for the initial version update. Further
changes were made to how DocValues are used, as this API is now sequential instead
of random-access.</li> <li>Smarter default config values based on number of CPU cores and max. heap memory.
A debug message will show that and how the default value for a missing was determined.</li> <li>Corpora larger than 2^31 tokens are now supported. The few operations
that don't support this yet will produce a clear error message. This functionality can
be disabled with the <code>search.enableHugeResultSets</code> setting (default <code>true</code>) that might
slightly improve performance.</li> <li>Warn if an annotation named 'word' or 'lemma' has no explicit <code>sensitivity</code> declared. Due to a special case, these will automatically get sensitivity <code>sensitive_insensitive</code>, but this quirk is deprecated and should not be relied upon.</li> <li>Clearer error message if no <code>indexLocations</code> were found.</li> <li>BLS now resolves symlinks while scanning indexLocations.</li> <li>BLS now allows dots in index names (in addition to underscore and dash).</li> <li>DocIndexerXPath now throws an exception if it encounters a non-UTF8 doc.</li> <li>FileProcessor should now handle files larges than 4G (although such files may lead to other problems, e.g. excessive memory use).</li> <li>When search is interrupted, there should now be a better indicating as to why.</li> <li>Stack trace should be included in more error responses if in debug mode.</li> <li>'Unauthorized to view content' error now refers to documentation.</li> <li>If a format config contains an error, report the file it occurs in.</li> <li>Document that the first annotation declared becomes the main annotation.</li> <li>BLS now also looks at <code>X-Forwarded-For</code> header to determine debug mode.</li> <li>BLS now accepts wildcards in the debug mode ip configuration.</li> <li>Update Jackson, revert YAML bug workaround.</li> <li>Improve how search/count times are reported in BLS.</li></ul> <h3 id="new-2"><a href="#new-2" class="header-anchor">#</a> New</h3> <ul><li>Added <code>naf</code> (NLP Annotation Format) to the builtin formats.</li> <li><code>FrequencyTool</code> is a commandline tool that allows you to get frequency lists for an entire corpus.</li></ul> <h3 id="java-api"><a href="#java-api" class="header-anchor">#</a> Java API</h3> <ul><li><code>Hits</code>, <code>HitsInternal(Mutable)</code>, CapturedGroups and other interfaces refactored to make
(im)mutability more explicit.</li> <li><code>Doc</code> and <code>DocImpl</code> classes were removed. Now that we use <code>DocValues</code> everywhere, caching
Lucene documents doesn't make sense.</li> <li>Searches should no longer get stuck queued even if maxConcurrentSearches is set to a low value.</li></ul> <h3 id="fixed-2"><a href="#fixed-2" class="header-anchor">#</a> Fixed</h3> <ul><li>Fix usecontent=orig with outputformat=json</li> <li>Fix metadata value frequency reading, which due to a bug with how YAML was handled would all be read back as 0.</li> <li>Fix an issue where <code>HitProperty.contextIndices</code> would seemingly change during a sort operation.</li> <li>Prevent NPE if no patt specified with <code>/hits</code> request.</li> <li>Fix <code>hitsProcessedAtLeast()</code> method not always blocking. It may not be clear from the name, but this method will wait for the specified amount of hits to be processed, or will return <code>false</code> if all hits were processed and there were fewer than that amount.</li> <li>Fix NPE for malformed sort string like <code>docid,</code>.</li> <li>Don't hardcode &quot;word&quot; as the main annotation.</li> <li>Fix errors when running tests in parallel.</li></ul> <h3 id="removed-2"><a href="#removed-2" class="header-anchor">#</a> Removed</h3> <ul><li>support for previous BlackLab indexes (because Lucene 8 cannot read Lucene 5 indexes);
you must reindex your data to use this version. If this is impractical, please keep
using v2.3.0 for now. We would like to provide a conversion tool at some point.</li> <li>support for obsolete content store and forward index files (cs types &quot;utf8&quot; and &quot;utf8zip&quot;,
fi version 3; these were all replaced with newer versions six years ago. older indexes
will need to be re-indexed)</li> <li>Some deprecated settings. A warning will be shown if the setting is still found.</li> <li>Deprecated methods from <code>Indexer</code>, among others.</li></ul> <h2 id="_2-3-1"><a href="#_2-3-1" class="header-anchor">#</a> 2.3.1</h2> <h3 id="fixed-3"><a href="#fixed-3" class="header-anchor">#</a> Fixed</h3> <ul><li>If another search needs a queued search, always unqueue it (avoids deadlock)</li> <li>Respect chosen context size for CSV export</li> <li>Update list of builtin formats so tei-p5 and the legacy tei formats can be found</li> <li>If format with same name is found, include the name in the exception</li> <li>Don't include metadataGroupInfo with every result for <code>/hits</code> and <code>/docs</code> responses, this was never intended and produced invalid JSON</li> <li>Don't crash if an unreadable index from a different BlackLab version is found, just skip it</li> <li>Add version and build time to WAR manifest.</li></ul> <h3 id="changed-4"><a href="#changed-4" class="header-anchor">#</a> Changed</h3> <ul><li>IndexTooOld/IndexTooNew replaced with IndexVersionMismatch. See exception message for details.</li></ul> <h2 id="_2-3-0"><a href="#_2-3-0" class="header-anchor">#</a> 2.3.0</h2> <h3 id="changed-5"><a href="#changed-5" class="header-anchor">#</a> Changed</h3> <ul><li>Language level set to Java 9, so we can use <code>Arrays.compare()</code> among other things
(and stay on a supported Java version).</li> <li>GitHub Action to automatically build and run integration tests on push</li></ul> <h3 id="documentation"><a href="#documentation" class="header-anchor">#</a> Documentation</h3> <ul><li>Added to blacklab-internals page.</li> <li>Update roadmap, who uses blacklab.</li> <li>Documentation, comments and code now use the terms &quot;annotated field&quot; and &quot;annotation&quot;
everywhere (some lingering occurrences of the older terms &quot;complex field&quot; and
&quot;property&quot; were removed).</li></ul> <h3 id="new-3"><a href="#new-3" class="header-anchor">#</a> New</h3> <ul><li>Alternative cache implementation (<code>ResultsCache</code> by <code>@eginez</code> of Lexion) that may be
faster in high-throughput scenarios. Note that this implementation currently does not
support queueing or aborting searches or getting a running totals count.</li> <li>Add processing step to concatenate separate date fields into one.</li> <li>Added format configuration <code>tei-p5.blf.yaml</code> that uses more standard <code>pos</code> attribute.
Renamed existing TEI format configurations to <code>-legacy</code>.</li></ul> <h3 id="fixed-4"><a href="#fixed-4" class="header-anchor">#</a> Fixed</h3> <ul><li>Gracefully shut down ExecutorServices to avoid hanging on application exit.</li> <li>Fixed intermittent crashes using synchronization.</li> <li>Fixed count hanging if underlying search was aborted due to timeout.</li> <li>Ensure all BLSpans are startpoint-sorted.</li> <li>Lowercase (desensitize) display values when grouping case-insensitively.</li> <li>Always run at least one search (don't queue if no searches are running)</li> <li>Fix convert and tag plugin functionality.</li> <li>Various smaller bugfixes.</li></ul> <h3 id="performance"><a href="#performance" class="header-anchor">#</a> Performance</h3> <ul><li>Only load document fields we actually need</li> <li>Some more optimizations for hit frequencies</li></ul> <h3 id="removed-3"><a href="#removed-3" class="header-anchor">#</a> Removed</h3> <ul><li>empty module <code>interfaces</code></li> <li>SQLite logging. Was never fully realized, and the new approach using Prometheus (see
<code>instrumentation</code> modules) is better.</li> <li><code>checkAgainMs</code> (from BLS response).</li> <li>several long-deprecated methods.</li></ul> <h2 id="_2-2-0"><a href="#_2-2-0" class="header-anchor">#</a> 2.2.0</h2> <h3 id="changed-6"><a href="#changed-6" class="header-anchor">#</a> Changed</h3> <ul><li>Make forward-index matching much less frequent, as it's difficult to predict when it will help, and it often hurts.</li> <li>Split into several projects that each handle specific functionality. More to do here.</li> <li>If either <code>wordsaroundhit</code> or <code>parameters.contextSize</code> are set to 0, don't include left and right context in the
results at all.</li> <li>The branch that corresponds to BlackLab's latest release is now called <em>main</em> instead of <em>master</em>. The default
branch remains the <em>dev</em> branch (up to date but potentially unstable)</li></ul> <h3 id="new-4"><a href="#new-4" class="header-anchor">#</a> New</h3> <ul><li>Added <code>instrumentation</code> modules to collect metrics using e.g. Prometheus.</li> <li>Greatly improve startup time and passive memory usage.</li> <li>Improved time to first result in (very) large indices.</li> <li>Improved performance by instantiating fewer objects (e.g. using <code>IntArrayLists</code> instead of <code>Hit</code> objects)</li> <li>Greatly improved speed of grouping on &quot;any token&quot; query, e.g. generating a frequency list for all or part of the corpus.</li> <li>Searches will now be queued (not started yet) if server load is too high.
Pausing already-started searches was removed, as this can keep a lot of memory from being used for running searches.</li> <li>If a search is aborted for taking too long, it will be held in cache for a while to prevent clients from immediately resubmitting.</li> <li><code>/search-test/</code> debug interface (experimental).</li> <li>Improved experimental Dockerfile.</li> <li>BlackLab Server test suite using Docker, Mocha and Chai.</li> <li>Simplified code for better maintainability.</li> <li>Documented blacklab internals (see https://inl.github.io/BlackLab/blacklab-internals.html)</li> <li>New setting <code>debug.alwaysAllowDebugInfo</code>, so each BLS request is considered in debugMode, e.g. /cache-info works, etc.</li> <li>New setting <code>indexing.maxNumberOfIndicesPerUser</code> to configure how many private indices each user is allowed.</li> <li>New setting <code>parameters.writeHitsAndDocsInGroupedHits</code> and query parameter includegroupcontents to include hits
with the grouped results.</li> <li>Handle index paths that are relative symlinks.</li></ul> <h3 id="fixed-5"><a href="#fixed-5" class="header-anchor">#</a> Fixed</h3> <ul><li>Upgrade to <code>log4j-2.17.1</code> (fixes <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" target="_blank" rel="noopener noreferrer">CVE-2021-44228<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046" target="_blank" rel="noopener noreferrer">CVE-2021-45046<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</li> <li>Bug that could cause metadata values from a previously indexed document to also be added to the next.</li> <li>YAML bug with metadata values containing newlines and colons.</li> <li>Bug in <code>TermsWriter</code> that caused a crash when indexing more than 134M unique terms.</li> <li>Deadlock because of fixed thread count and some subtasks getting run but not others. Now either allows entire search operation or queues it until later.</li> <li>Fix not all hits always counted when grouping/sorting.</li> <li>Fix metadata queries on numeric fields not working.</li> <li><code>HitsFromQueryParallel</code> queries can now be correctly aborted if they take too long.</li> <li><code>HitsFromQueryParallel</code> should work correctly with capture groups now. Sampled hits as well.</li> <li>Prevent NPE when not all hits have captured groups.</li> <li>Prevent <code>ConcurrentModificationException</code> caused by not synchronizing.</li> <li>Fix some caching bugs by consistently defining <code>hashCode()</code> and <code>equals()</code>.</li> <li>Report correct search time (used to underreport).</li> <li>Fixed slowdown when a lot of indexes are open at the same time.</li> <li>Many smaller bugfixes.</li></ul> <h3 id="removed-4"><a href="#removed-4" class="header-anchor">#</a> Removed</h3> <ul><li>Support for pre-2.0 configuration files. See <a href="/BlackLab/server/configuration.html">BLS configuration file</a>.</li> <li>Support for <code>useOldElementnames</code> (old BLS element names, using &quot;properties&quot; instead of &quot;annotations&quot;)</li></ul> <h2 id="_2-1-1"><a href="#_2-1-1" class="header-anchor">#</a> 2.1.1</h2> <h3 id="fixed-6"><a href="#fixed-6" class="header-anchor">#</a> Fixed</h3> <ul><li>Upgrade to log4j-2.16.0 (fixes CVE-2021-45046).</li></ul> <h2 id="_2-1-0"><a href="#_2-1-0" class="header-anchor">#</a> 2.1.0</h2> <h3 id="changed-7"><a href="#changed-7" class="header-anchor">#</a> Changed</h3> <ul><li>BLS: /termfreq operation no longer requires a filter query.</li></ul> <h3 id="new-5"><a href="#new-5" class="header-anchor">#</a> New</h3> <ul><li>Add MetadataFieldsWriter for programmatically setting the special fields
(in addition to doing so in .blf.yaml files)</li></ul> <h3 id="fixed-7"><a href="#fixed-7" class="header-anchor">#</a> Fixed</h3> <ul><li>Fix crash during indexing if terms file got very large.</li> <li>BLS: Fix incorrect check who user-owned formats.</li></ul> <h2 id="_2-0-0"><a href="#_2-0-0" class="header-anchor">#</a> 2.0.0</h2> <h3 id="api-changes"><a href="#api-changes" class="header-anchor">#</a> API changes</h3> <h4 id="bls"><a href="#bls" class="header-anchor">#</a> BLS</h4> <ul><li>(breaking change) BLS responses will now report metadata values as arrays,
because metadata fields can have multiple values.</li> <li>BLS now reports capture groups (in a captureGroups element for each hit) (by @severian)</li> <li>BLS now allows all headers in CORS requests</li> <li>You can now specify listvalues and/or listmetadatavalues to limit what annotations and metadata fields are returned.
If omitted, all annotations/fields are returned.</li> <li>BLS responses now include displayNames and &quot;tab grouping&quot; (if any) for metadata fields (thanks @eduarddrenth)</li></ul> <h4 id="java-library"><a href="#java-library" class="header-anchor">#</a> Java library</h4> <ul><li>(breaking change) Completely refactored Java API to be more clear and consistent.
See the migration guide.</li> <li>(only for advanced Java library usage)
Made the concept of a BlackLab instance (&quot;BlackLabEngine&quot;) explicit, so you can
e.g. decide how many threads you want your BlackLabEngine to have.</li></ul> <h3 id="new-6"><a href="#new-6" class="header-anchor">#</a> New</h3> <ul><li>In addition to VTD-XML, Saxon may be used to parse input files for indexing. Saxon supports XPath 3, which
contains many features useful for configuring input formats. It is also faster, at the cost of increased memory
usage for large files.</li> <li>Multiple values may be indexed for a metadata field (this is automatic when your XPath matches multiple values).
(this is is the reason why BLS will now report all metadata as lists of values, even if there's only one)</li> <li>Added mapValues option to map metadata field values while indexing</li> <li>It is now possible to configure global unknown condition and value (use metadataDefaultUnknownCondition
and metadataDefaultUnknownValue at the top-level of your indexing config)</li> <li>You can now set isInternal to true on annotations to prevent searching and grouping on it in corpus-frontend</li> <li>Added annotation option allowDuplicateValues (defaults to true). If multipleValues is true and allowDuplicateValues
is false, duplicates encountered will not be indexed twice, preventing double hits.</li> <li>Add support for retrieving occurrences of a list of terms, /blacklab-server/INDEX_NAME/termfreq</li></ul> <h3 id="changed-8"><a href="#changed-8" class="header-anchor">#</a> Changed</h3> <ul><li>Speeded up searches by allowing hits to be fetched in parallel</li> <li>New Search system that allows better optimization and integrates result
caching, allowing you to define an application-specific cache behaviour.</li> <li>There is a new version of the blacklab and blacklab-server configuration
files. The old version still works but will be removed in the future.
See migration-guide.md for the details of the new format.</li> <li>IndexTool now defaults to multithreaded indexing and the number of threads can be configured</li> <li>Calculating tokens in a subcorpus (using includetokencount=true on a docs query with
just a metadata filter) is much faster (through the use of DocValues).
We use DocValues in more places for performance improvements.</li> <li>In new indexes, subannotations are part of the index structure. As a result of this,
you can enumerate the subannotations and their values much more efficiently.
You can also specify any metadata you can specify for a regular annotation,
such as displayName, uiType, etc. Querying subannotations should be more efficient
as well.</li> <li>Indexing should use less memory now.</li> <li>Sparse annotations take up less disk space.</li> <li>Forward indexes take up less memory while searching, and are initialized in the
background for quicker startup.</li> <li>A number of new metadata settings are supported, such as annotationGroups.
More extensive documentation will follow.</li> <li>Added optional detailed SQLite logging for diagnosing performance issues.</li> <li>Improved error message when passing invalid regex expression or when query contains unknown annotation</li> <li>If punctPath matches an empty tag, replace it with a space. This deals with e.g. TEi <lb></lb> tags as punctuation.</li> <li>Don't autodetect titleField. If not set, use pidField. If that's not set, use fromInputFile.</li> <li>Allow leading wildcards in metadata filter queries</li> <li>If performance.maxThreadsPerSearch is set to 1, use HitsFromQuery instead of HitsFromQueryParallel</li> <li>Many smaller improvements.</li></ul> <h3 id="fixed-8"><a href="#fixed-8" class="header-anchor">#</a> Fixed</h3> <ul><li>Fixed a concurrency bug that could cause a search to get stuck.</li> <li>Capture groups work with parallel hit fetching (by @severian)</li> <li>HitGroups retain capture group information (by @severian)</li> <li>Fixed and sped up determining subcorpus size (for relative frequencies) when grouping</li> <li>Restore namespace on document element when fetching part of a document (by @eduarddrenth)</li> <li>maxConcurrentSearches is now always at least 4, to avoid deadlocks on single-core machines</li> <li>Warn if value is not stored because it's too long; increase maximum value length.
(if value exceeds 32K, it will be truncated when storing in DocValues)</li> <li>Only use NumericDocValues from a single thread at a time (reported by @severian)</li> <li>Sanitize field names containing characters not allowed in XML element names, so BLS responses are valid XML</li> <li>Fixed textDirection from config not working when creating new index</li> <li>When displaying left context, ensure the words are in original order</li> <li>Gap filling works when cql query contains a newline</li> <li>Fixed deleting documents from index, accidentally including deleted docs in results.</li> <li>Fix groups with a colon in the group name not working correctly</li> <li>Many smaller bugs in indexing and searching fixed</li> <li>Library versions updated</li></ul> <h3 id="removed-5"><a href="#removed-5" class="header-anchor">#</a> Removed</h3> <ul><li>Really old index formats (pre 1.4 or so) are no longer supported.
BlackLab will report this when you try to open such an old index.</li> <li>BLS no longer supports the rarely used block=no parameter for
polling-based asynchronous search. All search requests block until
the response is available. Only the &quot;total results&quot; count will be
reported asynchronously unless the &quot;waitfortotal&quot; parameters is true.</li></ul> <h2 id="_1-7-2"><a href="#_1-7-2" class="header-anchor">#</a> 1.7.2</h2> <h3 id="new-7"><a href="#new-7" class="header-anchor">#</a> New</h3> <ul><li>Issue warning if unrecognized params passed to Auth* class.</li></ul> <h3 id="changed-9"><a href="#changed-9" class="header-anchor">#</a> Changed</h3> <ul><li>Rewrite queries like [lemma=&quot;.*&quot;] to [] for efficiency</li></ul> <h3 id="fixed-9"><a href="#fixed-9" class="header-anchor">#</a> Fixed</h3> <ul><li>Sort matches for XPaths (VTD-XML does breadth-first search and doesn't
necessarily return matches in document order; this can be a problem for
more complex XPaths).</li> <li>Made timeout longer for hits queries to avoid Timeout error.</li> <li>Jackson and commons-compress libraries were updated because of patch
security vulnerabilities.</li></ul> <h2 id="_1-7-1"><a href="#_1-7-1" class="header-anchor">#</a> 1.7.1</h2> <h3 id="changed-10"><a href="#changed-10" class="header-anchor">#</a> Changed</h3> <ul><li>Default maximum file upload size is now 1GB.</li></ul> <h3 id="fixed-10"><a href="#fixed-10" class="header-anchor">#</a> Fixed</h3> <ul><li>Don't block until all hits have been counted.</li> <li>Fixed bug when maxHitsToRetrieve and maxHitsToCount are the same value</li></ul> <h2 id="_1-7-0"><a href="#_1-7-0" class="header-anchor">#</a> 1.7.0</h2> <h3 id="new-8"><a href="#new-8" class="header-anchor">#</a> New</h3> <ul><li>Much user-friendlier indexing using .json/.yaml config files.
Added support for tabular formats and plain text.
Includes built-in format configurations for many popular formats.
See documentation.</li> <li>Added &quot;linked document&quot; indexing, which provides e.g. the ability
to automatically locate and index the corresponding metadata for
each document.</li> <li>BLS can now return results in CSV format.</li> <li>BLS now supports an &quot;autocomplete&quot; request for metadata fields as well as
property values.</li> <li>Corpora now have a text direction setting that the user interface can
use to change how things are displayed.</li> <li>contentViewable can now be specified at the document level as well
as corpus-wide, by adding a metadata field named &quot;contentViewable&quot;
with the value &quot;true&quot; or &quot;false&quot;. The per-document setting overrides
the corpus-wide setting.</li> <li>BLS now allows private corpus owners to explicitly share the corpus with
other users.</li> <li>Many small additions to make it easier to generate a user-friendly
user interface based on corpus structure information from BlackLab Server,
such as displayName for fields and values, uiType for field and
properties, etc.</li> <li>BLS can now omit empty properties in the results if desired. Default is
to include empty properties. Use requests.omitEmptyProperties setting to
change.</li> <li>BLS will now send the &quot;Access-Control-Allow-Origin: *&quot; header by
default, allowing a frontend on another server to access it.
This can be overridden in the requests.accessControlAllowOrigin
setting.</li> <li>BLS can attempt to generate a default XSLT from a (XML-based) input format
configuration.</li> <li>Added a MetadataFetcher that reads from CSV files.</li> <li>Added plugin capability for document conversion and tagging before indexing,
allowing BLS to e.g. take ePub input files, convert them to a corpus format,
linguistically annotate them and index them. This feature is somewhat
experimental and as of yet undocumented.</li> <li>Many smaller improvements.</li></ul> <h3 id="changed-11"><a href="#changed-11" class="header-anchor">#</a> Changed</h3> <ul><li>BlackLab now requires Java 8.</li> <li>BLS no longer trims leading/trailing whitespace from parameter values.</li></ul> <h3 id="fixed-11"><a href="#fixed-11" class="header-anchor">#</a> Fixed</h3> <ul><li>Untokenized fields weren't lowercased while indexing, but were lowercased
when searching, causing problems. Now they are treated the same.</li> <li>Numerous other bugfixes.</li></ul> <h2 id="_1-6-0"><a href="#_1-6-0" class="header-anchor">#</a> 1.6.0</h2> <h3 id="new-9"><a href="#new-9" class="header-anchor">#</a> New</h3> <ul><li>Added Searcher.getBlackLabVersion(). Also added blacklabVersion to index.</li> <li>Added Hits.filteredBy() to filter Hits on a HitProperty.</li></ul> <h3 id="fixed-12"><a href="#fixed-12" class="header-anchor">#</a> Fixed</h3> <ul><li>Fixed bug with case-insensitive Terms.indexOf().</li> <li>Fixed buffer overrun while writing Terms file.</li> <li>Avoid problems with truncating mapped files on Windows.</li> <li>Fixed bug when rewriting &quot;n-grams containing at start/end ...&quot; queries.</li> <li>Fixed incorrect matching if ANDNOT has multiple negative clauses.</li> <li>Use Arrays.hashCode instead of Object.hashCode for int arrays.</li> <li>Fixed &quot;createWeight&quot; bug when filtering on range queries.</li> <li>Made it possible to create, close, and re-open an empty index.</li> <li>Memory leak in BLS because of bug in TextPattern.rewrite().</li> <li>Fixed bug with regexes including character class negations.</li> <li>Fixed some rare NullPointerExceptions.</li></ul> <h3 id="changed-12"><a href="#changed-12" class="header-anchor">#</a> Changed</h3> <ul><li>Added an alternative way of matching subqueries, using the forward index
and a nondeterministic finite automaton (NFA; similar to many regular expression
engines). Added an optimizer to choose when to use NFA matching.
Still tweaking, but certain types of queries should be faster with this.</li> <li>Made global constraints on capture groups possible.</li> <li>Added HitPropertyHitPosition for fast reproducible sorts.</li> <li>Made sure SpansSequenceSimple (which is fast) is used more often.</li> <li>Updated library versions, including migration to log4j 2.x.</li> <li>Indexer.index(File) now indexes all files by default instead of *.xml.
If you want to index *.xml, use Indexer.index(File, String glob).
IndexTool still defaults to *.xml; specify different glob if you want
to index other file types.</li> <li>Upgraded from Lucene 5.2.1 to 5.5.2. Also made some preparations for
eventually upgrading to Lucene 6.x.
Deprecated methods that use the deprecated Filter and replaced them with
a variant that takes Query.</li> <li>Removed several (long-)deprecated methods.</li> <li>SpanQueryFiltered.rewrite() rewrites its filter as well.</li> <li>BLSpanQuery is now the base class of all our SpanQuery classes, and is
used throughout the code. Only the API hasn't been updated yet, but
will throw IllegalArgumentException if a SpanQuery argument is not a
BLSpanQuery.</li> <li>Moved all TextPattern classes to nl.inl.blacklab.search package.
Moved all SpanQuery/Spans classes to nl.inl.blacklab.search.lucene.
Made some internal TextPattern methods package-private.</li> <li>Renamed SpanQueryBase to BLSpanQueryAbstract.</li> <li>Many improvements to documentation based on feedback and new features.</li> <li>Many optimizations, large and small.</li> <li>Many little fixes.</li></ul> <h3 id="blacklab-server"><a href="#blacklab-server" class="header-anchor">#</a> BlackLab Server</h3> <ul><li>Cleaned up logging, made debug logging configurable by subject.</li> <li>Improved configuration error handling, made index scanning recursive.</li> <li>Added /explain?patt=... to explain how queries are optimized.</li> <li>Made long-running count operations pause if client doesn't check status.</li> <li>Added parameterized querying (filling in gaps with TSV data).</li> <li>Added hitfiltercrit and hitfilterval parameters to filter hits on a criterium,
like &quot;word left of matched text&quot;. This allows you to view the hits in a single group
after grouping, and then still allows you to group on these hits again, unlike the
existing &quot;viewgroup&quot; parameter.</li> <li>Fixed cache bug that would cause &quot;Cannot decrement refs, job was already
cleaned up!&quot; message</li> <li>Made sure control characters are escaped properly in JSON and XML.</li> <li>Made sure regular and error output aren't mixed.</li> <li>In debug mode, include stacktrace with exception error.</li> <li>Added support for enumerating subproperties.</li> <li>Made sure TooManyClauses is caught and dealth with properly.</li> <li>Fixed bug when trying to sort hits by a metadata field.</li> <li>Improved how context words group property expressions are interpreted.</li> <li>Added blacklabVersion to server info page.</li> <li>When grouping, show groups from large to small unless another sort is requested.</li> <li>Return clean error message when user passes empty group parameter.</li> <li>When trying to sample more hits than available, just return all hits.</li> <li>If no pattern given, return a proper error message.</li> <li>Return sample parameters for all search types, not just ungrouped hits.</li> <li>Also include &quot;numberOfHits&quot; stat when viewing group of documents.</li> <li>Added error message when 'viewgroup' is used without 'group'.</li> <li>Don't add whitespace into leaf XML elements.</li></ul> <h2 id="_1-5-0"><a href="#_1-5-0" class="header-anchor">#</a> 1.5.0</h2> <h3 id="fixed-13"><a href="#fixed-13" class="header-anchor">#</a> Fixed</h3> <ul><li>Two rare, subtle matching bugs in SpansExpansion and SpansPositionFilter.</li> <li>Fixed indexing bug where the compression code would occasionally get stuck in a loop.</li></ul> <h3 id="changed-13"><a href="#changed-13" class="header-anchor">#</a> Changed</h3> <ul><li>Deprecated TextPattern.toString() methods that take arguments.</li> <li>Gave HitProperty and DocProperty default toString() implementation.</li> <li>Added methods for iterating over all Lucene documents, forward index documents,
content store documents.</li> <li>Added a test utility that can export your original corpus from the Lucene
index and content store (nl.inl.blacklab.testutil.ExportCorpus).</li> <li>Many RuntimeExceptions were changed to more specific subclasses like
IllegalArgumentException or UnsupportedOperationException.</li> <li>Made it possible to add a metadata field with a fixed value to every
document in a single IndexTool run. Useful if you want to combine multiple
corpora into a single index: add each corpus in a separate IndexTool run,
with a field Corpus with the appropriate name.</li></ul> <h3 id="blacklab-server-2"><a href="#blacklab-server-2" class="header-anchor">#</a> BlackLab Server</h3> <ul><li>Made it possible to use POST for queries, so you can execute very large
queries (many kilobytes). Note that very long (&gt;30KB) regular expressions
can trigger problems in Lucene though.</li> <li>Allowed previously forbidden all-docs query (now that large document
queries are faster and less memory hungry).</li> <li>Grouped results are sorted by identity by default now.</li> <li>Made docpid a general way to easily filter on a single document PID.</li> <li>Replaced building a DataObject tree and serializing it with directly
streaming the response data using DataStream, saving memory and time.</li> <li>Heavily refactored to be more modular.</li> <li>Removed some settings related to nonblocking mode, as they didn't seem
very useful.</li> <li>Used JSON.org library instead of copy of the code.</li> <li>FIXED: if counting hits takes too long, don't error out but show the
results we have.</li> <li>FIXED: Do returns results even if counting all the results was interrupted
because it took too long.</li></ul> <h2 id="_1-4-1"><a href="#_1-4-1" class="header-anchor">#</a> 1.4.1</h2> <h3 id="fixed-14"><a href="#fixed-14" class="header-anchor">#</a> Fixed</h3> <ul><li>Potential overflow bug in ContentStoreFixedBlock when retrieving content.</li> <li>ContentStoreFixedBlock decompression bug that occurred with highly compressable content.
(N.B. there is no need to re-index if you experienced either of the above bugs)</li></ul> <h3 id="changed-14"><a href="#changed-14" class="header-anchor">#</a> Changed</h3> <ul><li>Don't store Document objects in DocResults, saving memory and time.</li> <li>Changed BL-CQL subproperty separator (e.g. for querying part of speech features separately)
from ':' to '/'.</li></ul> <h3 id="blacklab-server-3"><a href="#blacklab-server-3" class="header-anchor">#</a> BlackLab Server</h3> <ul><li>Made sure missing options in blacklab-server.json don't cause problems.</li></ul> <h2 id="_1-4-0"><a href="#_1-4-0" class="header-anchor">#</a> 1.4.0</h2> <h3 id="new-10"><a href="#new-10" class="header-anchor">#</a> New</h3> <ul><li>Added experimental support for &quot;subproperties&quot;: properties that are indexed in the same Lucene
field, using prefixes, but don't each have a forward index. For now, mainly useful for
indexing each part of speech feature separately, but in the future, BlackLab could possibly move
to indexing all properties in a single Lucene field. See DocIndexerOpenSonar,
QueryExecutionContext.subpropPrefix().</li> <li>Added HitsSample and its implementation class, which can take a random sample of a larger
set of hits.</li> <li>Added HitPropertyContextWords, which gives the user more options for sorting/grouping on
context words, such as &quot;group on the first and last words of the matched text&quot; or &quot;group on the
second and third words to the left of the matched text&quot;.</li></ul> <h3 id="changed-15"><a href="#changed-15" class="header-anchor">#</a> Changed</h3> <ul><li>Performed some code cleanups, moved some internal classes to different packages.</li> <li>Made Searcher an abstract base class to SearcherImpl; Hits an abstract base class to HitsImpl.
Added mock classes for Searcher, Hits, ForwardIndex, Terms; used them to add tests.</li> <li>Moved hits-related settings from Searcher and Hits into a shared HitsSetting class;
Searcher has a default set of HitsSettings that Hits objects &quot;inherit&quot;.</li> <li>Updated gs-collections 6.1 to eclipse-collections 7.1. Replaced Map&lt;Integer, T&gt; with
IntObjectMap, Map&lt;Integer, Integer&gt; with IntIntMap, ArrayList&lt;Integer&gt; with IntArrayList
a number of times (mainly) for more memory-efficiency.</li> <li>Started using commons-lang to replace certain utility functions.</li> <li>Moved some basic Lucene functionality unrelated to the rest of BlackLab from Searcher to
LuceneUtil.</li></ul> <h2 id="_1-3-7"><a href="#_1-3-7" class="header-anchor">#</a> 1.3.7</h2> <h3 id="fixed-15"><a href="#fixed-15" class="header-anchor">#</a> Fixed</h3> <ul><li>Opening a large &quot;fixed-block&quot; content store took a really long time.</li></ul> <h2 id="_1-3-6"><a href="#_1-3-6" class="header-anchor">#</a> 1.3.6</h2> <h3 id="fixed-16"><a href="#fixed-16" class="header-anchor">#</a> Fixed</h3> <ul><li>Content store growing larger than 2 GB caused an integer overflow.</li> <li>DocIndexersXmlHandlers element matching didn't work correctly for some XML structures.</li> <li>Storing document in ContentStoreDirFixedBlock would very rarely crash due to a
block resizing bug.</li></ul> <h2 id="_1-3-5"><a href="#_1-3-5" class="header-anchor">#</a> 1.3.5</h2> <h3 id="new-11"><a href="#new-11" class="header-anchor">#</a> New</h3> <ul><li>Added default unknown condition and value to indextemplate.json, so you can specify what to do if a metadata field value is missing without specifying it for each field separately.</li></ul> <h3 id="fixed-17"><a href="#fixed-17" class="header-anchor">#</a> Fixed</h3> <ul><li>BLSpanOrQuery would occasionally miss valid hits due to a
bug in the advanceStartPoint() method.</li></ul> <h3 id="changed-16"><a href="#changed-16" class="header-anchor">#</a> Changed</h3> <ul><li>Switched to JavaCC 6.x.</li></ul> <h2 id="_1-3-4"><a href="#_1-3-4" class="header-anchor">#</a> 1.3.4</h2> <h3 id="fixed-18"><a href="#fixed-18" class="header-anchor">#</a> Fixed</h3> <ul><li>Lone carriage return characters in JSON output were not escaped;
Windows line endings were escaped as a single \n.</li></ul> <h2 id="_1-3-3"><a href="#_1-3-3" class="header-anchor">#</a> 1.3.3</h2> <h3 id="fixed-19"><a href="#fixed-19" class="header-anchor">#</a> Fixed</h3> <ul><li>Indices with old terms file format (pre-1.3) produced empty concordances.</li></ul> <h2 id="_1-3-2"><a href="#_1-3-2" class="header-anchor">#</a> 1.3.2</h2> <h3 id="fixed-20"><a href="#fixed-20" class="header-anchor">#</a> Fixed</h3> <ul><li>Query rewrite bug when combining identical clauses with different repetitions,
i.e. [pos=&quot;AA.<em>&quot;][pos=&quot;AA.</em>&quot;]* --&gt; [pos=&quot;AA.*&quot;]+</li> <li>Throw a descriptive error if an index contains no fields.</li></ul> <h3 id="changed-17"><a href="#changed-17" class="header-anchor">#</a> Changed</h3> <ul><li>Some small code quality improvements, like using .isEmpty() instead of .size() == 0.</li> <li>Added -javadoc and -sources JARs to Maven build, in preparation for publishing to Maven Central.</li> <li>Added distributionManagement section for deploying to OSSRH staging area.</li></ul> <h2 id="_1-3-1"><a href="#_1-3-1" class="header-anchor">#</a> 1.3.1</h2> <h3 id="new-12"><a href="#new-12" class="header-anchor">#</a> New</h3> <ul><li>Added new default content store format &quot;fixedblock&quot;, that improves space re-use when updating documents.</li></ul> <h3 id="fixed-21"><a href="#fixed-21" class="header-anchor">#</a> Fixed</h3> <ul><li>Bug in SpanQueryAnd which caused incorrect hits to be reported.</li></ul> <h3 id="changed-18"><a href="#changed-18" class="header-anchor">#</a> Changed</h3> <ul><li>Special OSX and Windows files are skipped, even if they occur inside archives.</li></ul> <h2 id="_1-3"><a href="#_1-3" class="header-anchor">#</a> 1.3</h2> <h3 id="added"><a href="#added" class="header-anchor">#</a> Added</h3> <ul><li>Searcher now implements Closeable, so it can be used with the try-with-resources statement.</li> <li>You can specify that properties should not get a forward index using the complexField property &quot;noForwardIndexProps&quot; (space-separated list of property names) in indextemplate.json.</li></ul> <h3 id="fixed-22"><a href="#fixed-22" class="header-anchor">#</a> Fixed</h3> <ul><li>Forward index terms is no longer limited to around 2 GB.</li></ul> <h3 id="changed-19"><a href="#changed-19" class="header-anchor">#</a> Changed</h3> <h2 id="_1-2-1"><a href="#_1-2-1" class="header-anchor">#</a> 1.2.1</h2> <h3 id="fixed-23"><a href="#fixed-23" class="header-anchor">#</a> Fixed</h3> <ul><li>Queries containing only a document filter (metadata filter) would return incorrect results.</li></ul> <h2 id="_1-2-0"><a href="#_1-2-0" class="header-anchor">#</a> 1.2.0</h2> <h3 id="changed-20"><a href="#changed-20" class="header-anchor">#</a> Changed</h3> <ul><li>Switched build from Ant to Maven, and added generating a project site with javadocs, reports, etc.</li> <li>Using less memory by switching some Maps in the forward index to the gs-collections one.</li> <li>Updated to Lucene 5.2.1.</li> <li>Added Maven project site, available at http://inl.github.io/BlackLab/</li> <li>Removed Lucene query parser for corpus queries.</li> <li>Keep tag end position in payload of start tag, which results in much faster tag searches.</li> <li>Rewrote many slower queries to make them (much) faster. Particularly searches with &quot;not&quot; parts and &quot;containing&quot;/&quot;within&quot; should be faster.</li> <li>Sped up &quot;containing&quot;, &quot;within&quot;, and other such filter queries.</li> <li>TextPatternAnd was renamed and expanded to TextPatternAndNot. TextPatternAnd is still available as a synonym, but has been deprecated.</li> <li>Added TextPatternFilterNGrams to speed up queries of the form: []{2,3} containing &quot;water&quot; (or the &quot;within&quot; equivalent).</li> <li>Added BLSpans.advanceStartPosition(target) to &quot;skip&quot; within a document.</li> <li>Commons-compress (used for reading .gz files) is statically linked now.</li> <li>Limited token length to 1000 (really long tokens would cause problems otherwise).</li></ul> <h3 id="fixed-24"><a href="#fixed-24" class="header-anchor">#</a> Fixed</h3> <ul><li>Empty version file causes NullPointerException.</li> <li>Missing manifest file causes NullPointerException.</li> <li>ContentStoreDir contained dependencies on the default encoding.</li> <li>A number of subtle search bugs.</li> <li>Opening an index by passing a symbolic link throws an exception.</li> <li>Miscellaneous small fixes.</li></ul> <h2 id="_1-1-0"><a href="#_1-1-0" class="header-anchor">#</a> 1.1.0</h2> <ul><li>Upgraded from Lucene 3.6 to Lucene 4.2. This should speed up regular expression searching, among other things. The required Lucene 4 modules are: core, highlighter, queries, queryparser, analyzers-common. Thanks to Marc Kemps-Sneijders from the Meertens Institute for the code submission!</li> <li>The awkwardly-named classes RandomAccessGroup(s) were renamed to HitGroup(s). Also, DocGrouper was renamed to DocGroups to match this naming scheme. The old versions are still around but have been deprecated.</li> <li>HitPropValue classes now need a Hits object to properly serialize/deserialize their values in a way that doesn't break after re-indexing.</li> <li>Manual object construction was replaced with method calls where possible, for convenience, speed and ease of refactoring. Examples: use Hits.window() instead of new HitsWindow(); use Hits.groupedBy() instead of new ResultsGrouper(); use DocResults.groupedBy() instead of new DocGroups(). (code to the HitGroups/DocGroups APIs instead of to the concrete type ResultsGrouper/DocGrouper). Same for DocResults.</li> <li>HitGroups now iterates over HitGroup (used to iterate over Group)</li> <li>If you just want to query documents (not find hits for a pattern), use Searcher.queryDocuments(Query) (returns DocResults without hits).</li> <li>Preferably use Hits.sortedBy() (returns a new Hits instance) instead of Hits.sort() (modifies Hits instance). In a future version, we want Hits to become immutable to facilitate caching in a multithreaded application. Note that although you get a new Hits instance, the hits themselves are not all copied (no need, because the Hit class is now immutable).</li> <li>LuceneQueryParser.allowLeadingWildcard now defaults to false like in Lucene itself. Call LuceneQueryParser.setAllowLeadingWildcard() to change the setting.</li> <li>If you want to control how indexing errors are handled, subclass IndexListener and override the errorOccurred() method. This method receives information on what file couldnt be indexed and why.</li> <li>Visibility for some internal classes and methods has been reduced from public to package-private to trim the public API footprint, promoting ease-of-use and facilitating future refactoring. This should not affect applications. If it does affect you, please let me know.</li> <li>Some other methods have been renamed, are no longer needed, etc. and have been deprecated. Deprecated methods state the preferred alternative in the @deprecated Javadoc directive.</li></ul> <h2 id="_1-0"><a href="#_1-0" class="header-anchor">#</a> 1.0</h2> <h3 id="features"><a href="#features" class="header-anchor">#</a> Features</h3> <ul><li>Sorting/grouping on multiple properties now works correctly. Use HitPropertyMultiple.</li> <li>You can now sort/group (case-/accent-) sensitively or insensitively.</li> <li>You can now easily get a larger snippet of context around a single hit (say, 100 words before and after the hit). Call Hits.getConcordance(String, Hit, int) for this purpose.</li> <li>Indexing classes now work using element handlers, making them much more readable. Supporting a new file format has become simpler as a result of this. TEI P4/P5 and FoLiA indexing classes are included with BlackLab now. See nl.inl.blacklab.indexers package.</li> <li>It is now possible to delete documents from your index. The forward indices will reuse the free space for new documents.</li> <li>The Hits class should be thread-safe now. This makes several things possible: paging through hits without re-executing the query and quickly displaying the first few hits while a background thread fetches the rest. You can even display a running counter while hits are being fetched.</li> <li>nl.inl.blacklab.tools.IndexTool is a new generic indexing tool. It is command-line utility that lets you create new indices, add documents to them and delete them again. Indexing can be customized via commandline parameters and/or a properties file. Pass --help for more info.</li> <li>QueryTool, the command-line search tool and demonstration program, has been improved with many little features, including a performance test mode.</li> <li>Long-running queries may be interrupted using Thread.interrupt(); this will stop the gathering of hits and return control to the caller.</li> <li>Hacked in (very) experimental SRU CQL (Contextual Query Language) support. Still needs a bit more love though. </li></ul> <h3 id="performance-memory-related"><a href="#performance-memory-related" class="header-anchor">#</a> Performance-/memory-related</h3> <ul><li>Concordances (for KWIC views) are constructed using the forward indices now (including the one for the new punct property, containing punctuation and whitespace between words  if you created your own indexer, it pays to update it to include this property). Before they were constructed using the content store, but this method is much faster and more disk cache friendly.</li> <li>Startup speed has been improved, and there is an option to automatically warm up forward indices (i.e. prime the disk cache) in a background thread on startup. Enable this by calling Searcher.setAutoWarmForwardIndices(true); before constructing a Searcher object. This may become the default behaviour in future versions.</li> <li>Applications have more control over the maximum number of hits to retrieve, and the maximum hits to count. Unlimited is also an option. By default, no more than 1M hits are retrieved, but all hits are counted.</li> <li>Several types of queries (notably, phrase searches) have been sped up using the guarantee methods in BLSpans to determine when certain operations can be skipped.</li> <li>Several other small improvements in performance and memory use.</li></ul> <h3 id="other"><a href="#other" class="header-anchor">#</a> Other</h3> <ul><li>Opening the BlackLab index should now be done using Searcher.open() instead of directly through constructor. See the [https://github.com/INL/BlackLab/commit/d1d1b71ca8d5ef2aea25eab5a6e12b7e51cf5f65 commit message] for the rationale.</li> <li>Several superfluous methods were deprecated to simplify the API. The Javadoc will indicate why a method was deprecated and what alternative you should use. Deprecated methods will be removed in the next major version.</li> <li>Many small bugs fixed, comments added and code structure improved.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/INL/BlackLab/edit/dev/site/docs/development/changelog.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/23/2023, 10:38:20 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/BlackLab/development/migration-guide.html" class="prev">
        Migration guide
      </a></span> <span class="next"><a href="/BlackLab/development/api-redesign/">
        Blacklab webservice API evolution
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BlackLab/assets/js/app.ff7e0bdb.js" defer></script><script src="/BlackLab/assets/js/2.3a027c82.js" defer></script><script src="/BlackLab/assets/js/17.06d27b1c.js" defer></script>
  </body>
</html>
