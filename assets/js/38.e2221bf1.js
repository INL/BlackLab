(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{313:function(e,a,t){"use strict";t.r(a);var r=t(13),o=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"blacklab-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blacklab-server"}},[e._v("#")]),e._v(" BlackLab Server")]),e._v(" "),a("h2",{attrs:{id:"what-is-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-it"}},[e._v("#")]),e._v(" What is it?")]),e._v(" "),a("p",[e._v("BlackLab Server is a web service providing a REST API for accessing BlackLab corpora. This makes it easy to use BlackLab from your favourite programming language. It can be used for anything from quick analysis scripts to full-featured corpus search applications.")]),e._v(" "),a("p",[e._v("This page explains how to set up and use BlackLab Server.")]),e._v(" "),a("h2",{attrs:{id:"basic-installation-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-installation-configuration"}},[e._v("#")]),e._v(" Basic installation, configuration")]),e._v(" "),a("h3",{attrs:{id:"using-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-docker"}},[e._v("#")]),e._v(" Using Docker")]),e._v(" "),a("p",[e._v("Images are available on "),a("a",{attrs:{href:"https://hub.docker.com/r/instituutnederlandsetaal/blacklab",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub"),a("OutboundLink")],1),e._v(". We are preparing for an official Docker release. The current image is usable, but should be considered experimental: details may change in the final version. Also, there's currently no stable release tags, only a "),a("code",[e._v("latest")]),e._v(" version (updated from the "),a("code",[e._v("dev")]),e._v(" branch with no particular schedule) and\nseveral versions of specific commits on the "),a("code",[e._v("dev")]),e._v(" branch.")]),e._v(" "),a("p",[e._v("Suggestions for improving the image (and this guide) are welcome.")]),e._v(" "),a("p",[e._v("A Docker version supporting "),a("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/build_enhancements/",target:"_blank",rel:"noopener noreferrer"}},[e._v("BuildKit"),a("OutboundLink")],1),e._v(" is required (18.09 or higher), as well as Docker Compose version 1.27.1 or higher.")]),e._v(" "),a("p",[e._v("We assume here that you are familiar with the BlackLab indexing process; see "),a("RouterLink",{attrs:{to:"/guide/indexing-with-blacklab.html"}},[e._v("Indexing with BlackLab")]),e._v(" to learn more.")],1),e._v(" "),a("p",[e._v("Create a file named "),a("code",[e._v("test.env")]),e._v(" with your indexing configuration:")]),e._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("BLACKLAB_FORMATS_DIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("/path/to/my/formats")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("INDEX_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("my-index")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("INDEX_FORMAT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("my-file-format")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("INDEX_INPUT_DIR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("/path/to/my/input-files")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("-Xmx10G")]),e._v("\n")])])]),a("p",[e._v("To index your data:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" compose --env-file test.env run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--rm")]),e._v(" indexer\n")])])]),a("p",[e._v("Now start the server:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-d")]),e._v("\n")])])]),a("p",[e._v("Your index should now be accessible at http://localhost:8080/blacklab-server/my-index.")]),e._v(" "),a("p",[e._v("See the "),a("a",{attrs:{href:"https://github.com/INL/BlackLab/tree/dev/docker#readme",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker README"),a("OutboundLink")],1),e._v(" for more details.")]),e._v(" "),a("h3",{attrs:{id:"java-jre"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-jre"}},[e._v("#")]),e._v(" Java JRE")]),e._v(" "),a("p",[e._v("Install a JRE (Java runtime environment). BlackLab requires at least version 11, but version 17 or newer versions should work as well.")]),e._v(" "),a("h3",{attrs:{id:"tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tomcat"}},[e._v("#")]),e._v(" Tomcat")]),e._v(" "),a("p",[e._v("BlackLab Server needs a Java application server to run. We will use Apache Tomcat.")]),e._v(" "),a("p",[e._v("Install Tomcat on your machine. See the "),a("a",{attrs:{href:"https://tomcat.apache.org/tomcat-9.0-doc/setup.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("official docs"),a("OutboundLink")],1),e._v(" or an OS-specific guide like "),a("a",{attrs:{href:"https://linuxize.com/post/how-to-install-tomcat-9-on-ubuntu-20-04/",target:"_blank",rel:"noopener noreferrer"}},[e._v("this one for Ubuntu"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("Tomcat 10 not yet supported")]),e._v(" "),a("p",[e._v("BlackLab currently uses Java EE and therefore runs in Tomcat 8 and 9, but not in Tomcat 10 (which migrated to "),a("a",{attrs:{href:"https://eclipse-foundation.blog/2020/06/23/jakarta-ee-is-taking-off/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jakarta EE"),a("OutboundLink")],1),e._v("). If you try to run BlackLab Server on Tomcat 10, you will get a "),a("a",{attrs:{href:"https://stackoverflow.com/questions/66711660/tomcat-10-x-throws-java-lang-noclassdeffounderror-on-javax-servlet-servletreques/66712199#66712199",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClassNotFoundException"),a("OutboundLink")],1),e._v(". A future release of BlackLab will migrate to Jakarta EE.")])]),e._v(" "),a("h3",{attrs:{id:"configuration-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-file"}},[e._v("#")]),e._v(" Configuration file")]),e._v(" "),a("p",[e._v("Create a configuration file "),a("code",[e._v("/etc/blacklab/blacklab-server.yaml")]),e._v(".")]),e._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[a("b",[e._v("TIP:")]),e._v(" Other locations for the configuration file")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("/etc/blacklab")]),e._v(" is not practical for you, you can also place "),a("code",[e._v("blacklab-server.yaml")]),e._v(" here:")]),e._v(" "),a("ul",[a("li",[e._v("the directory specified in "),a("code",[e._v("$BLACKLAB_CONFIG_DIR")]),e._v(", if Tomcat is started with this environment variable set (create or edit "),a("code",[e._v("setenv.sh")]),e._v(" in the Tomcat "),a("code",[e._v("bin")]),e._v(" directory to set environment variables, or e.g. put it in "),a("code",[e._v("/etc/sysconfig/tomcat")]),e._v(" on a system using systemd)")]),e._v(" "),a("li",[e._v("somewhere on Tomcat's Java classpath, e.g. in its "),a("code",[e._v("lib")]),e._v(" directory")]),e._v(" "),a("li",[a("code",[e._v("$HOME/.blacklab/")]),e._v(" (if you're running Tomcat under your own user account, e.g. on a development machine; "),a("code",[e._v("$HOME")]),e._v(" refers to your home directory)")])])]),e._v(" "),a("p",[e._v("The minimal configuration file only needs to specify a location for your corpora. Create a directory for your corpora, e.g. "),a("code",[e._v("/data/index")]),e._v(" and refer to it in your "),a("code",[e._v("blacklab-server.yaml")]),e._v(" file:")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("---")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("configVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Where BlackLab can find corpora")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("indexLocations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" /data/index\n")])])]),a("p",[e._v("Your corpora would be in directories "),a("code",[e._v("/data/index/corpus1")]),e._v(", "),a("code",[e._v("/data/index/corpus2")]),e._v(", etc.")]),e._v(" "),a("h3",{attrs:{id:"blacklab-server-war"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blacklab-server-war"}},[e._v("#")]),e._v(" BlackLab Server WAR")]),e._v(" "),a("p",[e._v("Download the BlackLab Server WAR (Java web application archive). You can either:")]),e._v(" "),a("ul",[a("li",[e._v("download the binary attached to the "),a("a",{attrs:{href:"https://github.com/INL/BlackLab/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("latest release"),a("OutboundLink")],1),e._v(" (the file should be called "),a("code",[e._v("blacklab-server-<VERSION>.war")]),e._v(") or")]),e._v(" "),a("li",[e._v("clone the "),a("a",{attrs:{href:"https://github.com/INL/BlackLab",target:"_blank",rel:"noopener noreferrer"}},[e._v("repository"),a("OutboundLink")],1),e._v(" and build it using Maven ("),a("code",[e._v("mvn package")]),e._v("; WAR file will be in "),a("code",[e._v("server/target/blacklab-server-<VERSION>.war")]),e._v(" ).")])]),e._v(" "),a("p",[e._v("Place "),a("code",[e._v("blacklab-server.war")]),e._v(" in Tomcat’s "),a("code",[e._v("webapps")]),e._v(" directory ("),a("code",[e._v("$TOMCAT/webapps/")]),e._v(", where "),a("code",[e._v("$TOMCAT")]),e._v(" is the directory where Tomcat is installed). Tomcat should automatically discover and deploy it, and you should be able to go to "),a("a",{attrs:{href:"http://servername:8080/blacklab-server/",title:"http://servername:8080/blacklab-server/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://servername:8080/blacklab-server/"),a("OutboundLink")],1),e._v(" and see the BlackLab Server information page, which includes a list of available corpora.")]),e._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[a("b",[e._v("TIP:")]),e._v(" Unicode URLs")]),e._v(" "),a("p",[e._v("To ensure the correct handling of accented characters in (search) URLs, you should "),a("a",{attrs:{href:"https://tomcat.apache.org/tomcat-9.0-doc/config/http.html#Common_Attributes",target:"_blank",rel:"noopener noreferrer"}},[e._v("configure Tomcat"),a("OutboundLink")],1),e._v(" to interpret URLs as UTF-8 (by default, it does ISO-8859-1) by adding an attribute "),a("code",[e._v('URIEncoding="UTF-8"')]),e._v(" to the "),a("code",[e._v("<Connector/>")]),e._v(" element with the attribute "),a("code",[e._v('port="8080"')]),e._v(" in Tomcat's "),a("code",[e._v("server.xml")]),e._v(" file.")]),e._v(" "),a("p",[e._v("Of course, make sure that URLs you send to BlackLab are URL-encoded using UTF-8 (so e.g. searching for "),a("code",[e._v('"señor"')]),e._v(" corresponds to a request like "),a("code",[e._v("http://myserver/blacklab-server/mycorpus/hits?patt=%22se%C3%B1or%22")]),e._v(" . "),a("RouterLink",{attrs:{to:"/frontend/"}},[e._v("BlackLab Frontend")]),e._v(" does this by default.")],1)]),e._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[a("b",[e._v("TIP:")]),e._v(" Memory usage")]),e._v(" "),a("p",[e._v("For larger indices, it is important to "),a("a",{attrs:{href:"http://crunchify.com/how-to-change-jvm-heap-setting-xms-xmx-of-tomcat/",target:"_blank",rel:"noopener noreferrer"}},[e._v("give Tomcat's JVM enough heap memory"),a("OutboundLink")],1),e._v(". (If heap memory is low and/or fragmented, the JVM garbage collector might start taking 100% CPU moving objects in order to recover enough free space, slowing things down to a crawl.) If you are indexing unique ids for each word, you may also be able to save memory by "),a("RouterLink",{attrs:{to:"/guide/how-to-configure-indexing.html#disable-fi"}},[e._v("disabling the forward")]),e._v(" index for that 'unique id' annotation.")],1),e._v(" "),a("p",[e._v("We used to also recommend locking the forward index in memory using the "),a("code",[e._v("vmtouch")]),e._v(" utility, but we now believe it's better to leave disk cache management to the operating system.")])]),e._v(" "),a("h2",{attrs:{id:"indexing-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#indexing-data"}},[e._v("#")]),e._v(" Indexing data")]),e._v(" "),a("p",[e._v("You can index your data using the provided commandline tool IndexTool. See "),a("RouterLink",{attrs:{to:"/guide/indexing-with-blacklab.html"}},[e._v("Indexing with BlackLab")]),e._v(".")],1),e._v(" "),a("p",[e._v("Another option is to configure user authentication to allow users to create corpora and add their data using BlackLab Server. See "),a("a",{attrs:{href:"http://localhost:8081/BlackLab/server/howtos.html#let-users-manage-their-own-corpora",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(" to get started.")]),e._v(" "),a("p",[e._v('There is currently no way to use BlackLab Server to add data to non-user ("global" or regular) corpora. In the future, this will be available using Solr.')]),e._v(" "),a("h2",{attrs:{id:"searching-your-corpus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#searching-your-corpus"}},[e._v("#")]),e._v(" Searching your corpus")]),e._v(" "),a("p",[e._v("You can try most BlackLab Server requests out by typing URLs into your browser. See "),a("RouterLink",{attrs:{to:"/server/overview.html"}},[e._v("How to use")]),e._v(" and the "),a("RouterLink",{attrs:{to:"/server/rest-api/#blacklab-server-rest-api-reference"}},[e._v("API reference")]),e._v(" for more information.")],1),e._v(" "),a("blockquote",[a("p",[a("strong",[e._v("TODO:")]),e._v(" provide a very short introduction here")])]),e._v(" "),a("p",[e._v("We have a full-featured corpus search frontend available. See "),a("RouterLink",{attrs:{to:"/frontend/"}},[e._v("BlackLab Frontend")]),e._v(" for more information.")],1),e._v(" "),a("h2",{attrs:{id:"what-s-next"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-s-next"}},[e._v("#")]),e._v(" What's next?")]),e._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/server/overview.html"}},[e._v("Take a guided tour")])],1),e._v(" "),a("li",[a("a",{attrs:{href:"rest-api"}},[e._v("See all the API endpoints")])]),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/server/from-different-languages.html"}},[e._v("Learn how to use it from your favourite language")])],1),e._v(" "),a("li",[a("RouterLink",{attrs:{to:"/server/configuration.html"}},[e._v("Configuration options for BlackLab Server")]),e._v(".")],1)])])}),[],!1,null,null,null);a.default=o.exports}}]);